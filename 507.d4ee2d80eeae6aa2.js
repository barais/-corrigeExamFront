(()=>{"use strict";var n,_e={54681:(n,y,i)=>{var P=i(75e3),p=i(32076),C=i(54968),h=i(54004),H=i(39300),_=i(971),K=i(24351),D=i(54469);var we=i(69751);!function ie(W){const e=new W,t=(0,C.R)(self,"message");return function ve(W,e){const t=e.pipe((0,h.U)(r=>r.data),(0,h.U)(r=>new P.P_(r.kind,r.value,r.error)),(0,H.h)(r=>"C"!==r.kind),(0,_.D)());return function w(W){return!!W.workUnit}(W)?t.pipe((0,K.b)(r=>(0,p.D)(W.workUnit(r)).pipe((0,D.i)()))):W.work(t).pipe((0,D.i)())}(e,t).subscribe(r=>{const f=postMessage;(function s(W){return!!W.selectTransferables})(e)&&r.hasValue?f(r,e.selectTransferables(r.value)):f(r)})}(class Ce{constructor(){this.opencvready=new Promise(e=>{const t=self;t.Module={scriptUrl:"content/opencv/4/opencv.js",onRuntimeInitialized(){cv.then(r=>{cv=r,cv.ready.then(()=>{e()}).catch(f=>{console.log(f)})})}},t.importScripts(t.Module.scriptUrl)})}workUnit(e){return new we.y(t=>{this.opencvready.then(()=>{if(e.marker){const r=this.alignImageBasedOnCircle(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,e.pageNumber,e.preference);r.pageNumber=e.pageNumber,t.next(r),t.complete()}else try{const r=this.alignImage(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,!1,e.preference.numberofpointToMatch,e.preference.numberofpointToMatch,e.pageNumber);r.pageNumber=e.pageNumber,t.next(r),t.complete()}catch(r){console.error(r)}}).catch(r=>{console.log(r)})})}selectTransferables(e){return[e.imageAligned]}imageDataFromMat(e){const t=new cv.Mat,r=e.type()%8,f=r<=cv.CV_8S?1:r<=cv.CV_32S?1/256:255,c=r===cv.CV_8S||r===cv.CV_16S?128:0;switch(e.convertTo(t,cv.CV_8U,f,c),t.type()){case cv.CV_8UC1:cv.cvtColor(t,t,cv.COLOR_GRAY2RGBA);break;case cv.CV_8UC3:cv.cvtColor(t,t,cv.COLOR_RGB2RGBA);break;case cv.CV_8UC4:break;default:throw new Error("Bad number of channels (Source image must have 1, 3 or 4 channels)")}const G=new ImageData(new Uint8ClampedArray(t.data),t.cols,t.rows);return t.delete(),G}roi(e,t,r){const f=e.size().width,c=e.size().height;return t.x+t.width>f&&(t.width=f-t.x),t.y+t.height>c&&(t.height=c-t.y),t.x<0&&(t.x=0),t.y<0&&(t.y=0),e.roi(t)}alignImage(e,t,r,f,c,G,z,E,$,F){const A=new ImageData(new Uint8ClampedArray(e),r,f),U=new ImageData(new Uint8ClampedArray(t),c,G),o=cv.matFromImageData(A);let Y=cv.matFromImageData(U),g=new cv.Mat,M=new cv.Mat;cv.cvtColor(Y,g,cv.COLOR_BGRA2GRAY),cv.cvtColor(o,M,cv.COLOR_BGRA2GRAY);const I=Math.trunc(o.size().width/20);let N=[],v=[],S={},V=!1,O=!1,b=!1,x=!1;const R=Math.min(g.size().width,M.size().width),B=Math.min(g.size().height,M.size().height);if(z){let l=new cv.Rect(0,0,R,B);V=this.matchSmallImage(g,M,N,v,l,1,E,$,F),O=!0,b=!0,x=!0}else{let l=I;for(;!V&&l<3*R/4&&l<2*B/3;){let k=new cv.Rect(0,0,l,l);V=this.matchSmallImage(g,M,N,v,k,1,E,$,F),V||(l+=Math.trunc(R/10))}for(l=I;!O&&l<3*R/4&&l<2*B/3;){let k=new cv.Rect(R-l,0,R,l);O=this.matchSmallImage(g,M,N,v,k,2,E,$,F),O||(l+=Math.trunc(R/10))}for(l=I;!b&&l<3*R/4&&l<2*B/3;){let k=new cv.Rect(0,B-l,l,B);b=this.matchSmallImage(g,M,N,v,k,3,E,$,F),b||(l+=Math.trunc(R/10))}for(l=I;!x&&l<3*R/4&&l<2*B/3;){let k=new cv.Rect(R-l,B-l,R,B);x=this.matchSmallImage(g,M,N,v,k,4,E,$,F),x||(l+=Math.trunc(R/10))}}if(V&&O&&b&&x){let l=cv.matFromArray(4,1,cv.CV_32FC2,N),k=cv.matFromArray(4,1,cv.CV_32FC2,v),J=cv.getPerspectiveTransform(l,k),a=new cv.Mat;cv.warpPerspective(Y,a,J,o.size(),cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),S.imageAligned=this.imageDataFromMat(a).data.buffer,S.imageAlignedWidth=a.size().width,S.imageAlignedHeight=a.size().height,l.delete(),k.delete(),a.delete(),console.log("Good match for page "+F)}else S.imageAligned=t.slice(0),S.imageAlignedWidth=c,S.imageAlignedHeight=G,console.log("no match for page "+F);return Y.delete(),o.delete(),g.delete(),M.delete(),S}matchSmallImage(e,t,r,f,c,G,z,E,$){let F=new cv.Mat;F=this.roi(e,c,F);let A=new cv.Mat;A=this.roi(t,c,A);let U=new cv.KeyPointVector,o=new cv.KeyPointVector,Y=new cv.Mat,g=new cv.Mat,M=new cv.AKAZE,I=new cv.Mat,N=new cv.Mat;M.detectAndCompute(F,I,U,Y),M.detectAndCompute(A,N,o,g);let v=new cv.DMatchVector,S=new cv.BFMatcher,V=new cv.DMatchVectorVector;S.knnMatch(Y,g,V,2);for(let a=0;a<V.size();++a){let L=V.get(a),j=L.get(0),Q=L.get(1),ee="0.7";void 0!==j&&void 0!==Q&&j.distance<=Q.distance*parseFloat(ee)&&v.push_back(j)}let O=[],b=[];for(let a=0;a<v.size();a++)O.push(U.get(v.get(a).queryIdx).pt.x+c.x),O.push(U.get(v.get(a).queryIdx).pt.y+c.y),b.push(o.get(v.get(a).trainIdx).pt.x+c.x),b.push(o.get(v.get(a).trainIdx).pt.y+c.y);let x=0,R=[];if(0===v.size())return!1;for(let a=0;a<v.size();a++){let L=(O[2*a]-b[2*a])*(O[2*a]-b[2*a])+(O[2*a+1]-b[2*a+1])*(O[2*a+1]-b[2*a+1]);L<Math.trunc(3*F.size().width/20)*Math.trunc(3*F.size().width/20)&&(R.push(L),x+=1)}const B=this.numAverage(R),l=this.dev(R);if(x<=z)return M.delete(),U.delete(),o.delete(),Y.delete(),g.delete(),I.delete(),N.delete(),F.delete(),A.delete(),V.delete(),v.delete(),S.delete(),!1;let k=0,J=[];for(let a=0;a<v.size();a++){let L=(O[2*a]-b[2*a])*(O[2*a]-b[2*a])+(O[2*a+1]-b[2*a+1])*(O[2*a+1]-b[2*a+1]);if(L<B+1*l&&L>B-1*l){k+=1,J.push(a);break}}return k<=E?(M.delete(),U.delete(),o.delete(),Y.delete(),g.delete(),I.delete(),N.delete(),F.delete(),A.delete(),V.delete(),v.delete(),S.delete(),!1):(J.forEach(a=>{r.push(U.get(v.get(+a).queryIdx).pt.x+c.x),r.push(U.get(v.get(+a).queryIdx).pt.y+c.y),f.push(o.get(v.get(+a).trainIdx).pt.x+c.x),f.push(o.get(v.get(+a).trainIdx).pt.y+c.y)}),M.delete(),U.delete(),o.delete(),Y.delete(),g.delete(),I.delete(),N.delete(),F.delete(),A.delete(),V.delete(),v.delete(),S.delete(),!0)}numAverage(e){return e.reduce((t,r)=>t+r,0)/e.length}dev(e){let t=e.reduce((f,c)=>f+c,0)/e.length,r=(e=e.map(f=>(f-t)**2)).reduce((f,c)=>f+c,0);return Math.sqrt(r/e.length)}alignImageBasedOnCircle(e,t,r,f,c,G,z,E){const $=new ImageData(new Uint8ClampedArray(e),r,f),F=new ImageData(new Uint8ClampedArray(t),c,G);let M,I,N,v,S,V,O,b,x,R,B,l,A=cv.matFromImageData($),U=new cv.Mat,o=new cv.Mat;cv.cvtColor(A,A,cv.COLOR_RGBA2GRAY),cv.HoughCircles(A,o,cv.HOUGH_GRADIENT,1,45,75,20,A.cols*E.minCircle/1e3,A.cols*E.maxCircle/1e3),o.cols>0&&(M=o.data32F[0],I=o.data32F[1],N=o.data32F[2],v=o.data32F[0],S=o.data32F[1],V=o.data32F[2],O=o.data32F[0],b=o.data32F[1],x=o.data32F[2],R=o.data32F[0],B=o.data32F[1],l=o.data32F[2]);const k=A.size().width,J=A.size().height;if(o.cols>0)for(let T=1;T<o.cols;T++){let u=o.data32F[3*T],m=o.data32F[3*T+1],X=o.data32F[3*T+2];u*u+m*m<=M*M+I*I&&(M=u,I=m,N=X),u*u+m*m>=R*R+B*B&&(R=u,B=m,l=X),(k-u)*(k-u)+m*m<=(k-v)*(k-v)+S*S&&(v=u,S=m,V=X),u*u+(J-m)*(J-m)<=O*O+(J-b)*(J-b)&&(O=u,b=m,x=X)}let a=cv.matFromImageData(F),L=new cv.Mat,j=new cv.Mat;cv.cvtColor(a,L,cv.COLOR_RGBA2GRAY);const Q=L.size().width,ee=L.size().height;cv.HoughCircles(L,j,cv.HOUGH_GRADIENT,1,45,75,15,x-3,x+3);let Z=[],le=[];const Me=180*(4*x*x-3.14159*x*x)/100;for(let T=0;T<j.cols;T++){let u=j.data32F[3*T],m=j.data32F[3*T+1];const X=u-x,ne=m-x;let te=2*x,re=2*x;X+te>Q&&(te=Q-X),ne+re>ee&&(re=ee-ne);let pe=new cv.Rect(u-x,m-x,te,re),ae=new cv.Mat;ae=this.roi(L,pe,ae),cv.threshold(ae,ae,0,255,cv.THRESH_OTSU+cv.THRESH_BINARY),cv.countNonZero(ae)<Me&&(Z.push(u),le.push(m)),ae.delete()}let ce,oe,de,he,ue,fe,me,ge;if(Z.length>0&&(ce=Z[0],oe=le[0],de=Z[0],he=le[0],ue=Z[0],fe=le[0],me=Z[0],ge=le[0]),Z.length>1)for(let T=0;T<Z.length;T++){let u=Z[T],m=le[T];u*u+m*m<=ce*ce+oe*oe&&(ce=u,oe=m),u*u+m*m>=me*me+ge*ge&&(me=u,ge=m),(Q-u)*(Q-u)+m*m<=(Q-de)*(Q-de)+he*he&&(de=u,he=m),u*u+(ee-m)*(ee-m)<=ue*ue+(ee-fe)*(ee-fe)&&(ue=u,fe=m)}if(Z.length>=4){let T=cv.matFromArray(4,1,cv.CV_32FC2,[M,I,v,S,O,b,R,B]),u=cv.matFromArray(4,1,cv.CV_32FC2,[ce,oe,de,he,ue,fe,me,ge]),m=cv.getPerspectiveTransform(u,T),X=new cv.Size(A.cols,A.rows);for(let re=0;re<T.rows;++re){let Ae=15,xe=new cv.Point(u.data32F[2*re],u.data32F[2*re+1]);cv.circle(a,xe,Ae,[0,0,255,255],1)}cv.warpPerspective(a,U,m,X,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar);let ne=U.clone(),te={};return te.imageAligned=this.imageDataFromMat(ne).data.buffer,te.imageAlignedWidth=ne.size().width,te.imageAlignedHeight=ne.size().height,A.delete(),U.delete(),o.delete(),L.delete(),a.delete(),j.delete(),T.delete(),u.delete(),ne.delete(),te}return A.delete(),U.delete(),o.delete(),L.delete(),a.delete(),j.delete(),this.alignImage(e,t,r,f,c,G,!1,E.numberofpointToMatch,E.numberofgoodpointToMatch,z)}})},96921:(n,y,i)=>{i.d(y,{w0:()=>h,Nn:()=>_});var P=i(30576),p=i(87896),C=i(38737);class h{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;const{_parentage:w}=this;if(w)if(this._parentage=null,Array.isArray(w))for(const q of w)q.remove(this);else w.remove(this);const{initialTeardown:ve}=this;if((0,P.m)(ve))try{ve()}catch(q){s=q instanceof p.B?q.errors:[q]}const{_finalizers:ie}=this;if(ie){this._finalizers=null;for(const q of ie)try{K(q)}catch(se){s=s??[],se instanceof p.B?s=[...s,...se.errors]:s.push(se)}}if(s)throw new p.B(s)}}add(s){var w;if(s&&s!==this)if(this.closed)K(s);else{if(s instanceof h){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=null!==(w=this._finalizers)&&void 0!==w?w:[]).push(s)}}_hasParent(s){const{_parentage:w}=this;return w===s||Array.isArray(w)&&w.includes(s)}_addParent(s){const{_parentage:w}=this;this._parentage=Array.isArray(w)?(w.push(s),w):w?[w,s]:s}_removeParent(s){const{_parentage:w}=this;w===s?this._parentage=null:Array.isArray(w)&&(0,C.P)(w,s)}remove(s){const{_finalizers:w}=this;w&&(0,C.P)(w,s),s instanceof h&&s._removeParent(this)}}function _(D){return D instanceof h||D&&"closed"in D&&(0,P.m)(D.remove)&&(0,P.m)(D.add)&&(0,P.m)(D.unsubscribe)}function K(D){(0,P.m)(D)?D():D.unsubscribe()}h.EMPTY=(()=>{const D=new h;return D.closed=!0,D})()},63269:(n,y,i)=>{i.d(y,{yG:()=>h});var P=i(93532);function h(_){return(0,P.K)(function p(_){return _[_.length-1]}(_))?_.pop():void 0}},54482:(n,y,i)=>{i.d(y,{e:()=>C});var P=i(30576);function C(h){return H=>{if(function p(h){return(0,P.m)(h?.lift)}(H))return H.lift(function(_){try{return h(_,this)}catch(K){this.error(K)}});throw new TypeError("Unable to lift unknown Observable type")}}},89635:(n,y,i)=>{i.d(y,{U:()=>C});var P=i(44671);function C(h){return 0===h.length?P.y:1===h.length?h[0]:function(_){return h.reduce((K,D)=>D(K),_)}}}},ye={};function d(n){var y=ye[n];if(void 0!==y)return y.exports;var i=ye[n]={exports:{}};return _e[n](i,i.exports,d),i.exports}d.m=_e,d.x=()=>{var n=d.O(void 0,[846],()=>d(54681));return d.O(n)},n=[],d.O=(y,i,P,p)=>{if(!i){var h=1/0;for(C=0;C<n.length;C++){for(var[i,P,p]=n[C],H=!0,_=0;_<i.length;_++)(!1&p||h>=p)&&Object.keys(d.O).every(ie=>d.O[ie](i[_]))?i.splice(_--,1):(H=!1,p<h&&(h=p));if(H){n.splice(C--,1);var K=P();void 0!==K&&(y=K)}}return y}p=p||0;for(var C=n.length;C>0&&n[C-1][2]>p;C--)n[C]=n[C-1];n[C]=[i,P,p]},d.d=(n,y)=>{for(var i in y)d.o(y,i)&&!d.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:y[i]})},d.f={},d.e=n=>Promise.all(Object.keys(d.f).reduce((y,i)=>(d.f[i](n,y),y),[])),d.u=n=>n+".dea30c4773c7f51a.js",d.miniCssF=n=>{},d.o=(n,y)=>Object.prototype.hasOwnProperty.call(n,y),(()=>{var n;d.tt=()=>(void 0===n&&(n={createScriptURL:y=>y},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(n=trustedTypes.createPolicy("angular#bundler",n))),n)})(),d.tu=n=>d.tt().createScriptURL(n),d.p="",(()=>{var n={507:1};d.f.i=(p,C)=>{n[p]||importScripts(d.tu(d.p+d.u(p)))};var i=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],P=i.push.bind(i);i.push=p=>{var[C,h,H]=p;for(var _ in h)d.o(h,_)&&(d.m[_]=h[_]);for(H&&H(d);C.length;)n[C.pop()]=1;P(p)}})(),(()=>{var n=d.x;d.x=()=>d.e(846).then(n)})(),d.x()})();