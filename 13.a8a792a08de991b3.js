(()=>{"use strict";var n,_e={5299:(n,C,i)=>{var U=i(75e3),g=i(32076),x=i(54968),p=i(54004),K=i(39300),y=i(971),Y=i(24351),B=i(54469);var we=i(68306);!function ne(G){const e=new G,t=(0,x.R)(self,"message");return function ge(G,e){const t=e.pipe((0,p.U)(r=>r.data),(0,p.U)(r=>new U.P_(r.kind,r.value,r.error)),(0,K.h)(r=>"C"!==r.kind),(0,y.D)());return function _(G){return!!G.workUnit}(G)?t.pipe((0,Y.b)(r=>(0,g.D)(G.workUnit(r)).pipe((0,B.i)()))):G.work(t).pipe((0,B.i)())}(e,t).subscribe(r=>{const u=postMessage;(function l(G){return!!G.selectTransferables})(e)&&r.hasValue?u(r,e.selectTransferables(r.value)):u(r)})}(class Ce{constructor(){this.opencvready=new Promise(e=>{const t=self;t.Module={scriptUrl:"content/opencv/4/opencv.js",onRuntimeInitialized(){cv.then(r=>{cv=r,cv.ready.then(()=>{e()}).catch(u=>{console.log(u)})})}},t.importScripts(t.Module.scriptUrl)})}workUnit(e){return new we.y(t=>{this.opencvready.then(()=>{if(e.marker){const r=this.alignImageBasedOnCircle(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,e.pageNumber,e.preference);r.pageNumber=e.pageNumber,t.next(r),t.complete()}else try{const r=this.alignImage(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,!1,e.preference.numberofpointToMatch,e.preference.numberofpointToMatch,e.pageNumber);r.pageNumber=e.pageNumber,t.next(r),t.complete()}catch(r){console.error(r)}}).catch(r=>{console.log(r)})})}selectTransferables(e){return[e.imageAligned]}imageDataFromMat(e){const t=new cv.Mat,r=e.type()%8,u=r<=cv.CV_8S?1:r<=cv.CV_32S?1/256:255,c=r===cv.CV_8S||r===cv.CV_16S?128:0;switch(e.convertTo(t,cv.CV_8U,u,c),t.type()){case cv.CV_8UC1:cv.cvtColor(t,t,cv.COLOR_GRAY2RGBA);break;case cv.CV_8UC3:cv.cvtColor(t,t,cv.COLOR_RGB2RGBA);break;case cv.CV_8UC4:break;default:throw new Error("Bad number of channels (Source image must have 1, 3 or 4 channels)")}const W=new ImageData(new Uint8ClampedArray(t.data),t.cols,t.rows);return t.delete(),W}roi(e,t,r){const u=e.size().width,c=e.size().height;return t.x+t.width>u&&(t.width=u-t.x),t.y+t.height>c&&(t.height=c-t.y),t.x<0&&(t.x=0),t.y<0&&(t.y=0),e.roi(t)}alignImage(e,t,r,u,c,W,P,k,$,I){const M=new ImageData(new Uint8ClampedArray(e),r,u),z=new ImageData(new Uint8ClampedArray(t),c,W),o=cv.matFromImageData(M);let H=cv.matFromImageData(z),m=new cv.Mat,w=new cv.Mat;cv.cvtColor(H,m,cv.COLOR_BGRA2GRAY),cv.cvtColor(o,w,cv.COLOR_BGRA2GRAY);const F=Math.trunc(o.size().width/20);let N=[],v=[],D={},L=!1,O=!1,b=!1,A=!1;const R=Math.min(m.size().width,w.size().width),S=Math.min(m.size().height,w.size().height);if(P){let s=new cv.Rect(0,0,R,S);L=this.matchSmallImage(m,w,N,v,s,1,k,$,I),O=!0,b=!0,A=!0}else{let s=F;for(;!L&&s<3*R/4&&s<2*S/3;){let E=new cv.Rect(0,0,s,s);L=this.matchSmallImage(m,w,N,v,E,1,k,$,I),L||(s+=Math.trunc(R/10))}for(s=F;!O&&s<3*R/4&&s<2*S/3;){let E=new cv.Rect(R-s,0,R,s);O=this.matchSmallImage(m,w,N,v,E,2,k,$,I),O||(s+=Math.trunc(R/10))}for(s=F;!b&&s<3*R/4&&s<2*S/3;){let E=new cv.Rect(0,S-s,s,S);b=this.matchSmallImage(m,w,N,v,E,3,k,$,I),b||(s+=Math.trunc(R/10))}for(s=F;!A&&s<3*R/4&&s<2*S/3;){let E=new cv.Rect(R-s,S-s,R,S);A=this.matchSmallImage(m,w,N,v,E,4,k,$,I),A||(s+=Math.trunc(R/10))}}if(L&&O&&b&&A){let s=cv.matFromArray(4,1,cv.CV_32FC2,N),E=cv.matFromArray(4,1,cv.CV_32FC2,v),J=cv.getPerspectiveTransform(s,E),a=new cv.Mat;cv.warpPerspective(H,a,J,o.size(),cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),D.imageAligned=this.imageDataFromMat(a).data.buffer,D.imageAlignedWidth=a.size().width,D.imageAlignedHeight=a.size().height,s.delete(),E.delete(),a.delete(),console.log("Good match for page "+I)}else D.imageAligned=t.slice(0),D.imageAlignedWidth=c,D.imageAlignedHeight=W,console.log("no match for page "+I);return H.delete(),o.delete(),m.delete(),w.delete(),D}matchSmallImage(e,t,r,u,c,W,P,k,$){let I=new cv.Mat;I=this.roi(e,c,I);let M=new cv.Mat;M=this.roi(t,c,M);let z=new cv.KeyPointVector,o=new cv.KeyPointVector,H=new cv.Mat,m=new cv.Mat,w=new cv.AKAZE,F=new cv.Mat,N=new cv.Mat;w.detectAndCompute(I,F,z,H),w.detectAndCompute(M,N,o,m);let v=new cv.DMatchVector,D=new cv.BFMatcher,L=new cv.DMatchVectorVector;D.knnMatch(H,m,L,2);for(let a=0;a<L.size();++a){let V=L.get(a),j=V.get(0),Q=V.get(1),ee="0.7";void 0!==j&&void 0!==Q&&j.distance<=Q.distance*parseFloat(ee)&&v.push_back(j)}let O=[],b=[];for(let a=0;a<v.size();a++)O.push(z.get(v.get(a).queryIdx).pt.x+c.x),O.push(z.get(v.get(a).queryIdx).pt.y+c.y),b.push(o.get(v.get(a).trainIdx).pt.x+c.x),b.push(o.get(v.get(a).trainIdx).pt.y+c.y);let A=0,R=[];if(0===v.size())return!1;for(let a=0;a<v.size();a++){let V=(O[2*a]-b[2*a])*(O[2*a]-b[2*a])+(O[2*a+1]-b[2*a+1])*(O[2*a+1]-b[2*a+1]);V<Math.trunc(3*I.size().width/20)*Math.trunc(3*I.size().width/20)&&(R.push(V),A+=1)}const S=this.numAverage(R),s=this.dev(R);if(A<=P)return w.delete(),z.delete(),o.delete(),H.delete(),m.delete(),F.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),D.delete(),!1;let E=0,J=[];for(let a=0;a<v.size();a++){let V=(O[2*a]-b[2*a])*(O[2*a]-b[2*a])+(O[2*a+1]-b[2*a+1])*(O[2*a+1]-b[2*a+1]);if(V<S+1*s&&V>S-1*s){E+=1,J.push(a);break}}return E<=k?(w.delete(),z.delete(),o.delete(),H.delete(),m.delete(),F.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),D.delete(),!1):(J.forEach(a=>{r.push(z.get(v.get(+a).queryIdx).pt.x+c.x),r.push(z.get(v.get(+a).queryIdx).pt.y+c.y),u.push(o.get(v.get(+a).trainIdx).pt.x+c.x),u.push(o.get(v.get(+a).trainIdx).pt.y+c.y)}),w.delete(),z.delete(),o.delete(),H.delete(),m.delete(),F.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),D.delete(),!0)}numAverage(e){return e.reduce((t,r)=>t+r,0)/e.length}dev(e){let t=e.reduce((u,c)=>u+c,0)/e.length,r=(e=e.map(u=>(u-t)**2)).reduce((u,c)=>u+c,0);return Math.sqrt(r/e.length)}alignImageBasedOnCircle(e,t,r,u,c,W,P,k){const $=new ImageData(new Uint8ClampedArray(e),r,u),I=new ImageData(new Uint8ClampedArray(t),c,W);let w,F,N,v,D,L,O,b,A,R,S,s,M=cv.matFromImageData($),z=new cv.Mat,o=new cv.Mat;cv.cvtColor(M,M,cv.COLOR_RGBA2GRAY),cv.HoughCircles(M,o,cv.HOUGH_GRADIENT,1,45,75,20,M.cols*k.minCircle/1e3,M.cols*k.maxCircle/1e3),o.cols>0&&(w=o.data32F[0],F=o.data32F[1],N=o.data32F[2],v=o.data32F[0],D=o.data32F[1],L=o.data32F[2],O=o.data32F[0],b=o.data32F[1],A=o.data32F[2],R=o.data32F[0],S=o.data32F[1],s=o.data32F[2]);const E=M.size().width,J=M.size().height;if(o.cols>0)for(let T=1;T<o.cols;T++){let h=o.data32F[3*T],f=o.data32F[3*T+1],X=o.data32F[3*T+2];h*h+f*f<=w*w+F*F&&(w=h,F=f,N=X),h*h+f*f>=R*R+S*S&&(R=h,S=f,s=X),(E-h)*(E-h)+f*f<=(E-v)*(E-v)+D*D&&(v=h,D=f,L=X),h*h+(J-f)*(J-f)<=O*O+(J-b)*(J-b)&&(O=h,b=f,A=X)}let a=cv.matFromImageData(I),V=new cv.Mat,j=new cv.Mat;cv.cvtColor(a,V,cv.COLOR_RGBA2GRAY);const Q=V.size().width,ee=V.size().height;cv.HoughCircles(V,j,cv.HOUGH_GRADIENT,1,45,75,15,A-3,A+3);let Z=[],se=[];const Me=180*(4*A*A-3.14159*A*A)/100;for(let T=0;T<j.cols;T++){let h=j.data32F[3*T],f=j.data32F[3*T+1];const X=h-A,ie=f-A;let te=2*A,re=2*A;X+te>Q&&(te=Q-X),ie+re>ee&&(re=ee-ie);let pe=new cv.Rect(h-A,f-A,te,re),ae=new cv.Mat;ae=this.roi(V,pe,ae),cv.threshold(ae,ae,0,255,cv.THRESH_OTSU+cv.THRESH_BINARY),cv.countNonZero(ae)<Me&&(Z.push(h),se.push(f)),ae.delete()}let ce,oe,de,he,ue,fe,me,ve;if(Z.length>0&&(ce=Z[0],oe=se[1],de=Z[0],he=se[1],ue=Z[0],fe=se[1],me=Z[0],ve=se[1]),Z.length>1)for(let T=0;T<Z.length;T++){let h=Z[T],f=se[T];h*h+f*f<=ce*ce+oe*oe&&(ce=h,oe=f),h*h+f*f>=me*me+ve*ve&&(me=h,ve=f),(Q-h)*(Q-h)+f*f<=(Q-de)*(Q-de)+he*he&&(de=h,he=f),h*h+(ee-f)*(ee-f)<=ue*ue+(ee-fe)*(ee-fe)&&(ue=h,fe=f)}if(Z.length>=4){let T=cv.matFromArray(4,1,cv.CV_32FC2,[w,F,v,D,O,b,R,S]),h=cv.matFromArray(4,1,cv.CV_32FC2,[ce,oe,de,he,ue,fe,me,ve]),f=cv.getPerspectiveTransform(h,T),X=new cv.Size(M.cols,M.rows);for(let re=0;re<T.rows;++re){let Ae=15,xe=new cv.Point(h.data32F[2*re],h.data32F[2*re+1]);cv.circle(a,xe,Ae,[0,0,255,255],1)}cv.warpPerspective(a,z,f,X,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar);let ie=z.clone(),te={};return te.imageAligned=this.imageDataFromMat(ie).data.buffer,te.imageAlignedWidth=ie.size().width,te.imageAlignedHeight=ie.size().height,M.delete(),z.delete(),o.delete(),V.delete(),a.delete(),j.delete(),T.delete(),h.delete(),ie.delete(),te}return M.delete(),z.delete(),o.delete(),V.delete(),a.delete(),j.delete(),this.alignImage(e,t,r,u,c,W,!1,k.numberofpointToMatch,k.numberofgoodpointToMatch,P)}})},96921:(n,C,i)=>{i.d(C,{w0:()=>p,Nn:()=>y});var U=i(30576),g=i(87896),x=i(38737);class p{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;const{_parentage:_}=this;if(_)if(this._parentage=null,Array.isArray(_))for(const q of _)q.remove(this);else _.remove(this);const{initialTeardown:ge}=this;if((0,U.m)(ge))try{ge()}catch(q){l=q instanceof g.B?q.errors:[q]}const{_teardowns:ne}=this;if(ne){this._teardowns=null;for(const q of ne)try{Y(q)}catch(le){l=null!=l?l:[],le instanceof g.B?l=[...l,...le.errors]:l.push(le)}}if(l)throw new g.B(l)}}add(l){var _;if(l&&l!==this)if(this.closed)Y(l);else{if(l instanceof p){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._teardowns=null!==(_=this._teardowns)&&void 0!==_?_:[]).push(l)}}_hasParent(l){const{_parentage:_}=this;return _===l||Array.isArray(_)&&_.includes(l)}_addParent(l){const{_parentage:_}=this;this._parentage=Array.isArray(_)?(_.push(l),_):_?[_,l]:l}_removeParent(l){const{_parentage:_}=this;_===l?this._parentage=null:Array.isArray(_)&&(0,x.P)(_,l)}remove(l){const{_teardowns:_}=this;_&&(0,x.P)(_,l),l instanceof p&&l._removeParent(this)}}function y(B){return B instanceof p||B&&"closed"in B&&(0,U.m)(B.remove)&&(0,U.m)(B.add)&&(0,U.m)(B.unsubscribe)}function Y(B){(0,U.m)(B)?B():B.unsubscribe()}p.EMPTY=(()=>{const B=new p;return B.closed=!0,B})()},63269:(n,C,i)=>{i.d(C,{yG:()=>p});var U=i(93532);function p(y){return(0,U.K)(function g(y){return y[y.length-1]}(y))?y.pop():void 0}},54482:(n,C,i)=>{i.d(C,{e:()=>x});var U=i(30576);function x(p){return K=>{if(function g(p){return(0,U.m)(null==p?void 0:p.lift)}(K))return K.lift(function(y){try{return p(y,this)}catch(Y){this.error(Y)}});throw new TypeError("Unable to lift unknown Observable type")}}}},ye={};function d(n){var C=ye[n];if(void 0!==C)return C.exports;var i=ye[n]={exports:{}};return _e[n](i,i.exports,d),i.exports}d.m=_e,d.x=()=>{var n=d.O(void 0,[579],()=>d(5299));return d.O(n)},n=[],d.O=(C,i,U,g)=>{if(!i){var p=1/0;for(x=0;x<n.length;x++){for(var[i,U,g]=n[x],K=!0,y=0;y<i.length;y++)(!1&g||p>=g)&&Object.keys(d.O).every(ne=>d.O[ne](i[y]))?i.splice(y--,1):(K=!1,g<p&&(p=g));if(K){n.splice(x--,1);var Y=U();void 0!==Y&&(C=Y)}}return C}g=g||0;for(var x=n.length;x>0&&n[x-1][2]>g;x--)n[x]=n[x-1];n[x]=[i,U,g]},d.d=(n,C)=>{for(var i in C)d.o(C,i)&&!d.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:C[i]})},d.f={},d.e=n=>Promise.all(Object.keys(d.f).reduce((C,i)=>(d.f[i](n,C),C),[])),d.u=n=>n+".cc6d8e69d39a1e39.js",d.miniCssF=n=>{},d.o=(n,C)=>Object.prototype.hasOwnProperty.call(n,C),(()=>{var n;d.tt=()=>(void 0===n&&(n={createScriptURL:C=>C},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(n=trustedTypes.createPolicy("angular#bundler",n))),n)})(),d.tu=n=>d.tt().createScriptURL(n),d.p="",(()=>{var n={13:1};d.f.i=(g,x)=>{n[g]||importScripts(d.tu(d.p+d.u(g)))};var i=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],U=i.push.bind(i);i.push=g=>{var[x,p,K]=g;for(var y in p)d.o(p,y)&&(d.m[y]=p[y]);for(K&&K(d);x.length;)n[x.pop()]=1;U(g)}})(),(()=>{var n=d.x;d.x=()=>d.e(579).then(n)})(),d.x()})();