(()=>{"use strict";var n,_e={4681:(n,C,i)=>{var S=i(4942),w=i(5e3),R=i(2076),m=i(4968),$=i(4004),A=i(9300),Z=i(971),H=i(4351),l=i(4469);var Ce=i(9751),ae=i(639);!function q(L){const e=new L,t=(0,m.R)(self,"message");return function le(L,e){const t=e.pipe((0,$.U)(r=>r.data),(0,$.U)(r=>new w.P_(r.kind,r.value,r.error)),(0,A.h)(r=>"C"!==r.kind),(0,Z.D)());return function ve(L){return!!L.workUnit}(L)?t.pipe((0,H.b)(r=>(0,R.D)(L.workUnit(r)).pipe((0,l.i)()))):L.work(t).pipe((0,l.i)())}(e,t).subscribe(r=>{const g=postMessage;(function M(L){return!!L.selectTransferables})(e)&&r.hasValue?g(r,e.selectTransferables(r.value)):g(r)})}(class Me{constructor(){(0,S.Z)(this,"opencvready",new Promise(e=>{const t=self;t.Module={scriptUrl:"content/opencv/4/opencv.js",onRuntimeInitialized(){cv.then(r=>{cv=r,cv.ready.then(()=>{e()}).catch(g=>{ae.log(g)})})}},t.importScripts(t.Module.scriptUrl)}))}workUnit(e){return new Ce.y(t=>{this.opencvready.then(()=>{if(e.marker){const r=this.alignImageBasedOnCircle(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,e.pageNumber,e.preference);r.pageNumber=e.pageNumber,t.next(r),t.complete()}else try{const r=this.alignImage(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,!1,e.preference.numberofpointToMatch,e.preference.numberofpointToMatch,e.pageNumber);e.imageA=void 0,e.imageB=void 0,r.pageNumber=e.pageNumber,t.next(r),t.complete()}catch(r){ae.error(r)}}).catch(r=>{ae.log(r)})})}selectTransferables(e){return[e.imageAligned]}imageDataFromMat(e){const t=new cv.Mat,r=e.type()%8,g=r<=cv.CV_8S?1:r<=cv.CV_32S?1/256:255,d=r===cv.CV_8S||r===cv.CV_16S?128:0;switch(e.convertTo(t,cv.CV_8U,g,d),t.type()){case cv.CV_8UC1:cv.cvtColor(t,t,cv.COLOR_GRAY2RGBA);break;case cv.CV_8UC3:cv.cvtColor(t,t,cv.COLOR_RGB2RGBA);break;case cv.CV_8UC4:break;default:throw new Error("Bad number of channels (Source image must have 1, 3 or 4 channels)")}const N=new ImageData(new Uint8ClampedArray(t.data),t.cols,t.rows);return t.delete(),N}roi(e,t){const r=e.size().width,g=e.size().height;return t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>g&&(t.height=g-t.y),t.x<0&&(t.x=0),t.y<0&&(t.y=0),e.roi(t)}alignImage(e,t,r,g,d,N,T,E,X,k){const F=new ImageData(new Uint8ClampedArray(e),r,g),B=new ImageData(new Uint8ClampedArray(t),d,N),c=cv.matFromImageData(F);let j=cv.matFromImageData(B),y=new cv.Mat,x=new cv.Mat;cv.cvtColor(j,y,cv.COLOR_BGRA2GRAY),cv.cvtColor(c,x,cv.COLOR_BGRA2GRAY);const b=Math.trunc(c.size().width/20);let K=[],_=[],G={},Y=!1,h=!1,u=!1,P=!1;const I=Math.min(y.size().width,x.size().width),O=Math.min(y.size().height,x.size().height);if(T){let s=new cv.Rect(0,0,I,O);Y=this.matchSmallImage(y,x,K,_,s,1,E,X,k),h=!0,u=!0,P=!0}else{let s=b;for(;!Y&&s<3*I/4&&s<2*O/3;){let D=new cv.Rect(0,0,s,s);Y=this.matchSmallImage(y,x,K,_,D,1,E,X,k),Y||(s+=Math.trunc(I/10))}for(s=b;!h&&s<3*I/4&&s<2*O/3;){let D=new cv.Rect(I-s,0,I,s);h=this.matchSmallImage(y,x,K,_,D,2,E,X,k),h||(s+=Math.trunc(I/10))}for(s=b;!u&&s<3*I/4&&s<2*O/3;){let D=new cv.Rect(0,O-s,s,O);u=this.matchSmallImage(y,x,K,_,D,3,E,X,k),u||(s+=Math.trunc(I/10))}for(s=b;!P&&s<3*I/4&&s<2*O/3;){let D=new cv.Rect(I-s,O-s,I,O);P=this.matchSmallImage(y,x,K,_,D,4,E,X,k),P||(s+=Math.trunc(I/10))}}if(Y&&h&&u&&P){let s=cv.matFromArray(K.length/2,1,cv.CV_32FC2,K),D=cv.matFromArray(_.length/2,1,cv.CV_32FC2,_),Q=cv.findHomography(s,D,cv.RANSAC),U=new cv.Mat;cv.warpPerspective(j,U,Q,c.size()),G.imageAligned=this.imageDataFromMat(U).data.buffer,G.imageAlignedWidth=U.size().width,G.imageAlignedHeight=U.size().height,s.delete(),D.delete(),Q.delete(),U.delete(),ae.log("Good match for page "+k)}else G.imageAligned=t.slice(0),G.imageAlignedWidth=d,G.imageAlignedHeight=N,ae.log("no match for page "+k);return j.delete(),c.delete(),y.delete(),x.delete(),G}matchSmallImage(e,t,r,g,d,N,T,E,X){let k=new cv.Mat;k=this.roi(e,d);let F=new cv.Mat;F=this.roi(t,d);let B=new cv.KeyPointVector,c=new cv.KeyPointVector,j=new cv.Mat,y=new cv.Mat,x=new cv.AKAZE,b=new cv.Mat,K=new cv.Mat;x.detectAndCompute(k,b,B,j),x.detectAndCompute(F,K,c,y);let _=new cv.DMatchVector,G=new cv.BFMatcher,Y=new cv.DMatchVectorVector;G.knnMatch(j,y,Y,2);for(let a=0;a<Y.size();++a){let V=Y.get(a),J=V.get(0),v=V.get(1);void 0!==J&&void 0!==v&&J.distance<=v.distance*parseFloat("0.7")&&_.push_back(J)}let h=[],u=[];for(let a=0;a<_.size();a++)h.push(B.get(_.get(a).queryIdx).pt.x+d.x),h.push(B.get(_.get(a).queryIdx).pt.y+d.y),u.push(c.get(_.get(a).trainIdx).pt.x+d.x),u.push(c.get(_.get(a).trainIdx).pt.y+d.y);let P=0,I=[];if(0===_.size())return x.delete(),B.delete(),c.delete(),j.delete(),y.delete(),b.delete(),K.delete(),k.delete(),F.delete(),Y.delete(),_.delete(),G.delete(),!1;const O=[];for(let a=0;a<_.size();a++){let V=(h[2*a]-u[2*a])*(h[2*a]-u[2*a])+(h[2*a+1]-u[2*a+1])*(h[2*a+1]-u[2*a+1]);V<Math.trunc(3*k.size().width/20)*Math.trunc(3*k.size().height/20)&&(I.push(V),P+=1,O.push(a))}const s=this.numAverage(I);let D=this.dev(I);if(D<1&&(D=1),P<=T)return x.delete(),B.delete(),c.delete(),j.delete(),y.delete(),b.delete(),K.delete(),k.delete(),F.delete(),Y.delete(),_.delete(),G.delete(),!1;let Q=0,U=[];for(let a=0;a<O.length;a++){let V=(h[2*O[a]]-u[2*O[a]])*(h[2*O[a]]-u[2*O[a]])+(h[2*O[a]+1]-u[2*O[a]+1])*(h[2*O[a]+1]-u[2*O[a]+1]);V<=s+1*D&&V>=s-1*D&&(Q+=1,U.push(O[a]))}if(ae.error("first realgoodmatchtokeep",Q,E),Q<=E)return x.delete(),B.delete(),c.delete(),j.delete(),y.delete(),b.delete(),K.delete(),k.delete(),F.delete(),Y.delete(),_.delete(),G.delete(),!1;{let a=[];const V=[];U.forEach(v=>{V.push((h[2*v]-u[2*v])*(h[2*v]-u[2*v])+(h[2*v+1]-u[2*v+1])*(h[2*v+1]-u[2*v+1]))});const J=this.numAverage(V);return U.sort((v,z)=>Math.abs((h[2*v]-u[2*v])*(h[2*v]-u[2*v])+(h[2*v+1]-u[2*v+1])*(h[2*v+1]-u[2*v+1])-J)-Math.abs((h[2*z]-u[2*z])*(h[2*z]-u[2*z])+(h[2*z+1]-u[2*z+1]*(h[2*z+1]-u[2*z+1]))-J)),a.push(U[0]),a.push(U[1]),a.push(U[2]),a.push(U[3]),a.push(U[4]),ae.error("last realgoodmatchtokeep",a.length,E),a.forEach(v=>{r.push(B.get(_.get(+v).queryIdx).pt.x+d.x),r.push(B.get(_.get(+v).queryIdx).pt.y+d.y),g.push(c.get(_.get(+v).trainIdx).pt.x+d.x),g.push(c.get(_.get(+v).trainIdx).pt.y+d.y)}),x.delete(),B.delete(),c.delete(),j.delete(),y.delete(),b.delete(),K.delete(),k.delete(),F.delete(),Y.delete(),_.delete(),G.delete(),!0}}numAverage(e){return e.reduce((t,r)=>t+r,0)/e.length}dev(e){let t=e.reduce((g,d)=>g+d,0)/e.length,r=(e=e.map(g=>(g-t)**2)).reduce((g,d)=>g+d,0);return Math.sqrt(r/e.length)}alignImageBasedOnCircle(e,t,r,g,d,N,T,E){const X=new ImageData(new Uint8ClampedArray(e),r,g),k=new ImageData(new Uint8ClampedArray(t),d,N);let x,b,K,_,G,Y,h,u,P,I,O,s,F=cv.matFromImageData(X),B=new cv.Mat,c=new cv.Mat;cv.cvtColor(F,F,cv.COLOR_RGBA2GRAY),cv.HoughCircles(F,c,cv.HOUGH_GRADIENT,1,45,75,20,F.cols*E.minCircle/1e3,F.cols*E.maxCircle/1e3),c.cols>0&&(x=c.data32F[0],b=c.data32F[1],K=c.data32F[2],_=c.data32F[0],G=c.data32F[1],Y=c.data32F[2],h=c.data32F[0],u=c.data32F[1],P=c.data32F[2],I=c.data32F[0],O=c.data32F[1],s=c.data32F[2]);const D=F.size().width,Q=F.size().height;if(c.cols>0)for(let W=1;W<c.cols;W++){let f=c.data32F[3*W],p=c.data32F[3*W+1],ee=c.data32F[3*W+2];f*f+p*p<=x*x+b*b&&(x=f,b=p,K=ee),f*f+p*p>=I*I+O*O&&(I=f,O=p,s=ee),(D-f)*(D-f)+p*p<=(D-_)*(D-_)+G*G&&(_=f,G=p,Y=ee),f*f+(Q-p)*(Q-p)<=h*h+(Q-u)*(Q-u)&&(h=f,u=p,P=ee)}let U=cv.matFromImageData(k),a=new cv.Mat,V=new cv.Mat;cv.cvtColor(U,a,cv.COLOR_RGBA2GRAY);const J=a.size().width,v=a.size().height;cv.HoughCircles(a,V,cv.HOUGH_GRADIENT,1,45,75,15,P-3,P+3);let z=[],se=[];const xe=180*(4*P*P-3.14159*P*P)/100;for(let W=0;W<V.cols;W++){let f=V.data32F[3*W],p=V.data32F[3*W+1];const ee=f-P,ie=p-P;let te=2*P,re=2*P;ee+te>J&&(te=J-ee),ie+re>v&&(re=v-ie);let ye=new cv.Rect(f-P,p-P,te,re),ne=new cv.Mat;ne=this.roi(a,ye),cv.threshold(ne,ne,0,255,cv.THRESH_OTSU+cv.THRESH_BINARY),cv.countNonZero(ne)<xe&&(z.push(f),se.push(p)),ne.delete()}let ce,oe,de,he,ue,fe,me,ge;if(z.length>0&&(ce=z[0],oe=se[0],de=z[0],he=se[0],ue=z[0],fe=se[0],me=z[0],ge=se[0]),z.length>1)for(let W=0;W<z.length;W++){let f=z[W],p=se[W];f*f+p*p<=ce*ce+oe*oe&&(ce=f,oe=p),f*f+p*p>=me*me+ge*ge&&(me=f,ge=p),(J-f)*(J-f)+p*p<=(J-de)*(J-de)+he*he&&(de=f,he=p),f*f+(v-p)*(v-p)<=ue*ue+(v-fe)*(v-fe)&&(ue=f,fe=p)}if(z.length>=4){let W=cv.matFromArray(4,1,cv.CV_32FC2,[x,b,_,G,h,u,I,O]),f=cv.matFromArray(4,1,cv.CV_32FC2,[ce,oe,de,he,ue,fe,me,ge]),p=cv.getPerspectiveTransform(f,W),ee=new cv.Size(F.cols,F.rows);for(let re=0;re<W.rows;++re){let Oe=15,Re=new cv.Point(f.data32F[2*re],f.data32F[2*re+1]);cv.circle(U,Re,Oe,[0,0,255,255],1)}cv.warpPerspective(U,B,p,ee,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar);let ie=B.clone(),te={};return te.imageAligned=this.imageDataFromMat(ie).data.buffer,te.imageAlignedWidth=ie.size().width,te.imageAlignedHeight=ie.size().height,F.delete(),B.delete(),c.delete(),a.delete(),U.delete(),V.delete(),W.delete(),f.delete(),ie.delete(),te}return F.delete(),B.delete(),c.delete(),a.delete(),U.delete(),V.delete(),this.alignImage(e,t,r,g,d,N,!1,E.numberofpointToMatch,E.numberofgoodpointToMatch,T)}})},6921:(n,C,i)=>{i.d(C,{Nn:()=>A,w0:()=>m});var S=i(576),w=i(7896),R=i(8737);class m{constructor(l){this.initialTeardown=l,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let l;if(!this.closed){this.closed=!0;const{_parentage:M}=this;if(M)if(this._parentage=null,Array.isArray(M))for(const q of M)q.remove(this);else M.remove(this);const{initialTeardown:ve}=this;if((0,S.m)(ve))try{ve()}catch(q){l=q instanceof w.B?q.errors:[q]}const{_finalizers:le}=this;if(le){this._finalizers=null;for(const q of le)try{Z(q)}catch(pe){l=l??[],pe instanceof w.B?l=[...l,...pe.errors]:l.push(pe)}}if(l)throw new w.B(l)}}add(l){var M;if(l&&l!==this)if(this.closed)Z(l);else{if(l instanceof m){if(l.closed||l._hasParent(this))return;l._addParent(this)}(this._finalizers=null!==(M=this._finalizers)&&void 0!==M?M:[]).push(l)}}_hasParent(l){const{_parentage:M}=this;return M===l||Array.isArray(M)&&M.includes(l)}_addParent(l){const{_parentage:M}=this;this._parentage=Array.isArray(M)?(M.push(l),M):M?[M,l]:l}_removeParent(l){const{_parentage:M}=this;M===l?this._parentage=null:Array.isArray(M)&&(0,R.P)(M,l)}remove(l){const{_finalizers:M}=this;M&&(0,R.P)(M,l),l instanceof m&&l._removeParent(this)}}function A(H){return H instanceof m||H&&"closed"in H&&(0,S.m)(H.remove)&&(0,S.m)(H.add)&&(0,S.m)(H.unsubscribe)}function Z(H){(0,S.m)(H)?H():H.unsubscribe()}m.EMPTY=(()=>{const H=new m;return H.closed=!0,H})()},3269:(n,C,i)=>{i.d(C,{yG:()=>m});var S=i(3532);function m(A){return(0,S.K)(function w(A){return A[A.length-1]}(A))?A.pop():void 0}},4482:(n,C,i)=>{i.d(C,{e:()=>R});var S=i(576);function R(m){return $=>{if(function w(m){return(0,S.m)(m?.lift)}($))return $.lift(function(A){try{return m(A,this)}catch(Z){this.error(Z)}});throw new TypeError("Unable to lift unknown Observable type")}}},9635:(n,C,i)=>{i.d(C,{U:()=>R});var S=i(4671);function R(m){return 0===m.length?S.y:1===m.length?m[0]:function(A){return m.reduce((Z,H)=>H(Z),A)}}}},we={};function o(n){var C=we[n];if(void 0!==C)return C.exports;var i=we[n]={exports:{}};return _e[n](i,i.exports,o),i.exports}o.m=_e,o.x=()=>{var n=o.O(void 0,[788,696],()=>o(4681));return o.O(n)},n=[],o.O=(C,i,S,w)=>{if(!i){var m=1/0;for(R=0;R<n.length;R++){for(var[i,S,w]=n[R],$=!0,A=0;A<i.length;A++)(!1&w||m>=w)&&Object.keys(o.O).every(le=>o.O[le](i[A]))?i.splice(A--,1):($=!1,w<m&&(m=w));if($){n.splice(R--,1);var Z=S();void 0!==Z&&(C=Z)}}return C}w=w||0;for(var R=n.length;R>0&&n[R-1][2]>w;R--)n[R]=n[R-1];n[R]=[i,S,w]},o.d=(n,C)=>{for(var i in C)o.o(C,i)&&!o.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:C[i]})},o.f={},o.e=n=>Promise.all(Object.keys(o.f).reduce((C,i)=>(o.f[i](n,C),C),[])),o.u=n=>n+"."+{696:"9359b519a07dd466",788:"7b93429b3035d4de"}[n]+".js",o.miniCssF=n=>{},o.o=(n,C)=>Object.prototype.hasOwnProperty.call(n,C),(()=>{var n;o.tt=()=>(void 0===n&&(n={createScriptURL:C=>C},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(n=trustedTypes.createPolicy("angular#bundler",n))),n)})(),o.tu=n=>o.tt().createScriptURL(n),o.p="",(()=>{var n={507:1};o.f.i=(w,R)=>{n[w]||importScripts(o.tu(o.p+o.u(w)))};var i=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],S=i.push.bind(i);i.push=w=>{var[R,m,$]=w;for(var A in m)o.o(m,A)&&(o.m[A]=m[A]);for($&&$(o);R.length;)n[R.pop()]=1;S(w)}})(),(()=>{var n=o.x;o.x=()=>Promise.all([o.e(788),o.e(696)]).then(n)})(),o.x()})();