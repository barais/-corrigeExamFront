(()=>{"use strict";var l,be={8459:(l,b,s)=>{var E=s(4942),M=s(5500),z=s(7715),m=s(2438),J=s(7398),A=s(2181),Q=s(8906),G=s(6328),d=s(8857);var Re=s(5592);!function le(H){const e=new H,r=(0,m.R)(self,"message");return function he(H,e){const r=e.pipe((0,J.U)(i=>i.data),(0,J.U)(i=>new M.P_(i.kind,i.value,i.error)),(0,A.h)(i=>"C"!==i.kind),(0,Q.D)());return function Ae(H){return!!H.workUnit}(H)?r.pipe((0,G.b)(i=>(0,z.D)(H.workUnit(i)).pipe((0,d.i)()))):H.work(r).pipe((0,d.i)())}(e,r).subscribe(i=>{const v=postMessage;(function x(H){return!!H.selectTransferables})(e)&&i.hasValue?v(i,e.selectTransferables(i.value)):v(i)})}(class Fe{constructor(){(0,E.Z)(this,"opencvready",new Promise(e=>{const r=self;r.Module={scriptUrl:"content/opencv/4/opencv.js",onRuntimeInitialized(){cv.then(i=>{cv=i,cv.ready.then(()=>{e()}).catch(v=>{console.log(v)})})}},r.importScripts(r.Module.scriptUrl)}))}workUnit(e){return new Re.y(r=>{this.opencvready.then(()=>{if(e.marker){const i=this.alignImageBasedOnCircle(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,e.pageNumber,e.preference,e.debug);i.pageNumber=e.pageNumber,r.next(i),r.complete()}else try{const i=this.alignImage(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,!1,e.preference.numberofpointToMatch,e.preference.numberofpointToMatch,e.pageNumber,e.debug);e.imageA=void 0,e.imageB=void 0,i.pageNumber=e.pageNumber,r.next(i),r.complete()}catch(i){console.error(i)}}).catch(i=>{console.log(i)})})}selectTransferables(e){return void 0!==e.imagesDebugTraces?[e.imageAligned,e.imagesDebugTraces]:[e.imageAligned]}imageDataFromMat(e){const r=new cv.Mat,i=e.type()%8,v=i<=cv.CV_8S?1:i<=cv.CV_32S?1/256:255,u=i===cv.CV_8S||i===cv.CV_16S?128:0;switch(e.convertTo(r,cv.CV_8U,v,u),r.type()){case cv.CV_8UC1:cv.cvtColor(r,r,cv.COLOR_GRAY2RGBA);break;case cv.CV_8UC3:cv.cvtColor(r,r,cv.COLOR_RGB2RGBA);break;case cv.CV_8UC4:break;default:throw new Error("Bad number of channels (Source image must have 1, 3 or 4 channels)")}const N=new ImageData(new Uint8ClampedArray(r.data),r.cols,r.rows);return r.delete(),N}roi(e,r){const i=e.size().width,v=e.size().height;return r.x+r.width>i&&(r.width=i-r.x),r.y+r.height>v&&(r.height=v-r.y),r.x<0&&(r.x=0),r.y<0&&(r.y=0),e.roi(r)}alignImage(e,r,i,v,u,N,S,U,ie,B,$){const I=new ImageData(new Uint8ClampedArray(e),i,v),w=new ImageData(new Uint8ClampedArray(r),u,N),D=cv.matFromImageData(I);let n=cv.matFromImageData(w),P=new cv.Mat,j=new cv.Size(D.size().width,D.size().height);cv.resize(n,P,j,0,0,cv.INTER_AREA);let T=new cv.Mat,g=new cv.Mat;cv.cvtColor(P,T,cv.COLOR_BGRA2GRAY),cv.cvtColor(D,g,cv.COLOR_BGRA2GRAY);const X=Math.trunc(D.size().width/20);let F=[],c=[],o={},L=!1,K=!1,p=!1,Z=!1;const R=Math.min(T.size().width,g.size().width),Y=Math.min(T.size().height,g.size().height);if(S){let a=new cv.Rect(0,0,R,Y);L=this.matchSmallImage(T,g,F,c,a,1,U,ie,B),K=!0,p=!0,Z=!0}else{let a=X;for(;!L&&a<3*R/4&&a<2*Y/3;){let t=new cv.Rect(0,0,a,a);L=this.matchSmallImage(T,g,F,c,t,1,U,ie,B),L||(a+=Math.trunc(R/10))}for(a=X;!K&&a<3*R/4&&a<2*Y/3;){let t=new cv.Rect(R-a,0,R,a);K=this.matchSmallImage(T,g,F,c,t,2,U,ie,B),K||(a+=Math.trunc(R/10))}for(a=X;!p&&a<3*R/4&&a<2*Y/3;){let t=new cv.Rect(0,Y-a,a,Y);p=this.matchSmallImage(T,g,F,c,t,3,U,ie,B),p||(a+=Math.trunc(R/10))}for(a=X;!Z&&a<3*R/4&&a<2*Y/3;){let t=new cv.Rect(R-a,Y-a,R,Y);Z=this.matchSmallImage(T,g,F,c,t,4,U,ie,B),Z||(a+=Math.trunc(R/10))}}if(L&&K&&p&&Z){let a=cv.matFromArray(F.length/2,1,cv.CV_32FC2,F),t=cv.matFromArray(c.length/2,1,cv.CV_32FC2,c),V=cv.findHomography(a,t,cv.RANSAC),k=new cv.Mat;if(cv.warpPerspective(P,k,V,D.size()),o.imageAligned=this.imageDataFromMat(k).data.buffer,o.imageAlignedWidth=k.size().width,o.imageAlignedHeight=k.size().height,$){let y=new cv.MatVector;y.push_back(D),y.push_back(P);let C=new cv.Mat;cv.hconcat(y,C);const oe=c.length/2;for(let q=0;q<oe;q++){let ne={x:c[2*q],y:c[2*q+1]},ee={x:D.size().width+F[2*q],y:F[2*q+1]};cv.circle(C,ne,5,[0,255,0,255],1),cv.circle(C,ee,5,[0,255,0,255],1),cv.line(C,ne,ee,[0,255,0,255],1)}o.imagesDebugTraces=this.imageDataFromMat(C).data.buffer,o.imagesDebugTracesWidth=C.size().width,o.imagesDebugTracesHeight=C.size().height}a.delete(),t.delete(),V.delete(),k.delete()}else if(o.imageAligned=r.slice(0),o.imageAlignedWidth=u,o.imageAlignedHeight=N,$){let a=new cv.MatVector;a.push_back(D),a.push_back(P);let t=new cv.Mat;cv.hconcat(a,t),o.imagesDebugTraces=this.imageDataFromMat(t).data.buffer,o.imagesDebugTracesWidth=t.size().width,o.imagesDebugTracesHeight=t.size().height}return n.delete(),P.delete(),D.delete(),T.delete(),g.delete(),o}matchSmallImage(e,r,i,v,u,N,S,U,ie){let B=new cv.Mat;B=this.roi(e,u);let $=new cv.Mat;$=this.roi(r,u);let I=new cv.KeyPointVector,w=new cv.KeyPointVector,D=new cv.Mat,n=new cv.Mat,P=new cv.AKAZE,j=new cv.Mat,T=new cv.Mat;P.detectAndCompute(B,j,I,D),P.detectAndCompute($,T,w,n);let g=new cv.DMatchVector,X=new cv.BFMatcher,F=new cv.DMatchVectorVector;X.knnMatch(D,n,F,2);for(let t=0;t<F.size();++t){let V=F.get(t),k=V.get(0),y=V.get(1);void 0!==k&&void 0!==y&&k.distance<=y.distance*parseFloat("0.7")&&g.push_back(k)}let c=[],o=[];for(let t=0;t<g.size();t++)c.push(I.get(g.get(t).queryIdx).pt.x+u.x),c.push(I.get(g.get(t).queryIdx).pt.y+u.y),o.push(w.get(g.get(t).trainIdx).pt.x+u.x),o.push(w.get(g.get(t).trainIdx).pt.y+u.y);let L=0,K=[];if(0===g.size())return P.delete(),I.delete(),w.delete(),D.delete(),n.delete(),j.delete(),T.delete(),B.delete(),$.delete(),F.delete(),g.delete(),X.delete(),!1;const p=[];for(let t=0;t<g.size();t++){let V=(c[2*t]-o[2*t])*(c[2*t]-o[2*t])+(c[2*t+1]-o[2*t+1])*(c[2*t+1]-o[2*t+1]);V<Math.trunc(3*B.size().width/20)*Math.trunc(3*B.size().height/20)&&(K.push(V),L+=1,p.push(t))}const Z=this.numAverage(K);let R=this.dev(K);if(R<1&&(R=1),L<=S)return P.delete(),I.delete(),w.delete(),D.delete(),n.delete(),j.delete(),T.delete(),B.delete(),$.delete(),F.delete(),g.delete(),X.delete(),!1;let Y=0,a=[];for(let t=0;t<p.length;t++){let V=(c[2*p[t]]-o[2*p[t]])*(c[2*p[t]]-o[2*p[t]])+(c[2*p[t]+1]-o[2*p[t]+1])*(c[2*p[t]+1]-o[2*p[t]+1]);V<=Z+1*R&&V>=Z-1*R&&(Y+=1,a.push(p[t]))}if(Y<=U)return P.delete(),I.delete(),w.delete(),D.delete(),n.delete(),j.delete(),T.delete(),B.delete(),$.delete(),F.delete(),g.delete(),X.delete(),!1;{let t=[];const V=[];a.forEach(y=>{V.push((c[2*y]-o[2*y])*(c[2*y]-o[2*y])+(c[2*y+1]-o[2*y+1])*(c[2*y+1]-o[2*y+1]))});const k=this.numAverage(V);return a.sort((y,C)=>Math.abs((c[2*y]-o[2*y])*(c[2*y]-o[2*y])+(c[2*y+1]-o[2*y+1])*(c[2*y+1]-o[2*y+1])-k)-Math.abs((c[2*C]-o[2*C])*(c[2*C]-o[2*C])+(c[2*C+1]-o[2*C+1]*(c[2*C+1]-o[2*C+1]))-k)),t.push(a[0]),t.push(a[1]),t.push(a[2]),t.push(a[3]),t.push(a[4]),t.forEach(y=>{i.push(I.get(g.get(+y).queryIdx).pt.x+u.x),i.push(I.get(g.get(+y).queryIdx).pt.y+u.y),v.push(w.get(g.get(+y).trainIdx).pt.x+u.x),v.push(w.get(g.get(+y).trainIdx).pt.y+u.y)}),P.delete(),I.delete(),w.delete(),D.delete(),n.delete(),j.delete(),T.delete(),B.delete(),$.delete(),F.delete(),g.delete(),X.delete(),!0}}numAverage(e){return e.reduce((r,i)=>r+i,0)/e.length}dev(e){let r=e.reduce((v,u)=>v+u,0)/e.length,i=(e=e.map(v=>(v-r)**2)).reduce((v,u)=>v+u,0);return Math.sqrt(i/e.length)}alignImageBasedOnCircle(e,r,i,v,u,N,S,U,ie){const B=new ImageData(new Uint8ClampedArray(e),i,v),$=new ImageData(new Uint8ClampedArray(r),u,N);let T,g,X,F,c,o,L,K,p,Z,R,Y,I=cv.matFromImageData(B),w=new cv.Mat,D=new cv.Mat,n=new cv.Mat;cv.cvtColor(I,w,cv.COLOR_RGBA2GRAY),cv.HoughCircles(w,n,cv.HOUGH_GRADIENT,1,45,75,20,w.cols*U.minCircle/1e3,w.cols*U.maxCircle/1e3),n.cols>0&&(T=n.data32F[0],g=n.data32F[1],X=n.data32F[2],F=n.data32F[0],c=n.data32F[1],o=n.data32F[2],L=n.data32F[0],K=n.data32F[1],p=n.data32F[2],Z=n.data32F[0],R=n.data32F[1],Y=n.data32F[2]);const a=w.size().width,t=w.size().height;if(n.cols>0)for(let W=1;W<n.cols;W++){let f=n.data32F[3*W],_=n.data32F[3*W+1],ce=n.data32F[3*W+2];f*f+_*_<=T*T+g*g&&(T=f,g=_,X=ce),f*f+_*_>=Z*Z+R*R&&(Z=f,R=_,Y=ce),(a-f)*(a-f)+_*_<=(a-F)*(a-F)+c*c&&(F=f,c=_,o=ce),f*f+(t-_)*(t-_)<=L*L+(t-K)*(t-K)&&(L=f,K=_,p=ce)}let V=cv.matFromImageData($),k=new cv.Mat,y=new cv.Size(w.size().width,w.size().height);cv.resize(V,k,y,0,0,cv.INTER_AREA);let C=new cv.Mat,oe=new cv.Mat;cv.cvtColor(k,C,cv.COLOR_RGBA2GRAY);const q=C.size().width,ne=C.size().height;cv.HoughCircles(C,oe,cv.HOUGH_GRADIENT,1,45,75,15,p-3,p+3);let ee=[],ue=[];const Oe=180*(4*p*p-3.14159*p*p)/100;for(let W=0;W<oe.cols;W++){let f=oe.data32F[3*W],_=oe.data32F[3*W+1];const ce=f-p,de=_-p;let se=2*p,ae=2*p;ce+se>q&&(se=q-ce),de+ae>ne&&(ae=ne-de);let Me=new cv.Rect(f-p,_-p,se,ae),O=new cv.Mat;O=this.roi(C,Me),cv.threshold(O,O,0,255,cv.THRESH_OTSU+cv.THRESH_BINARY),cv.countNonZero(O)<Oe&&(ee.push(f),ue.push(_)),O.delete()}let fe,me,ge,ve,pe,ye,_e,we;if(ee.length>0&&(fe=ee[0],me=ue[0],ge=ee[0],ve=ue[0],pe=ee[0],ye=ue[0],_e=ee[0],we=ue[0]),ee.length>1)for(let W=0;W<ee.length;W++){let f=ee[W],_=ue[W];f*f+_*_<=fe*fe+me*me&&(fe=f,me=_),f*f+_*_>=_e*_e+we*we&&(_e=f,we=_),(q-f)*(q-f)+_*_<=(q-ge)*(q-ge)+ve*ve&&(ge=f,ve=_),f*f+(ne-_)*(ne-_)<=pe*pe+(ne-ye)*(ne-ye)&&(pe=f,ye=_)}if(ee.length>=4){let W=cv.matFromArray(4,1,cv.CV_32FC2,[T,g,F,c,L,K,Z,R]),f=cv.matFromArray(4,1,cv.CV_32FC2,[fe,me,ge,ve,pe,ye,_e,we]),_=cv.getPerspectiveTransform(f,W),ce=new cv.Size(w.cols,w.rows);for(let ae=0;ae<W.rows;++ae){let te=15,re=new cv.Point(f.data32F[2*ae],f.data32F[2*ae+1]);cv.circle(k,re,te,[0,0,255,255],1)}cv.warpPerspective(k,D,_,ce,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar);let de=D.clone(),se={};if(se.imageAligned=this.imageDataFromMat(de).data.buffer,se.imageAlignedWidth=de.size().width,se.imageAlignedHeight=de.size().height,ie){let ae=new cv.MatVector;ae.push_back(I),ae.push_back(k);let Me=new cv.Size(2*I.size().width,w.size().height),O=new cv.Mat(Me,I.type());cv.hconcat(ae,O);let te={x:T,y:g},re={x:w.size().width+fe,y:me};cv.circle(O,te,15,[0,255,0,255],1),cv.circle(O,re,15,[0,255,0,255],1),cv.line(O,te,re,[0,255,0,255],1),te={x:F,y:c},re={x:w.size().width+ge,y:ve},cv.circle(O,te,15,[0,255,0,255],1),cv.circle(O,re,15,[0,255,0,255],1),cv.line(O,te,re,[0,255,0,255],1),te={x:L,y:K},re={x:w.size().width+pe,y:ye},cv.circle(O,te,15,[0,255,0,255],1),cv.circle(O,re,15,[0,255,0,255],1),cv.line(O,te,re,[0,255,0,255],1),te={x:Z,y:R},re={x:w.size().width+_e,y:we},cv.circle(O,te,15,[0,255,0,255],1),cv.circle(O,re,15,[0,255,0,255],1),cv.line(O,te,re,[0,255,0,255],1),se.imagesDebugTraces=this.imageDataFromMat(O).data.buffer,se.imagesDebugTracesWidth=O.size().width,se.imagesDebugTracesHeight=O.size().height}return I.delete(),w.delete(),D.delete(),n.delete(),C.delete(),k.delete(),V.delete(),oe.delete(),W.delete(),f.delete(),de.delete(),se}return I.delete(),w.delete(),D.delete(),n.delete(),C.delete(),k.delete(),V.delete(),oe.delete(),this.alignImage(e,r,i,v,u,N,!1,U.numberofpointToMatch,U.numberofgoodpointToMatch,S,ie)}})},5113:(l,b,s)=>{s.d(b,{Nn:()=>A,w0:()=>m});var E=s(4674),M=s(9732),z=s(9039);class m{constructor(d){this.initialTeardown=d,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let d;if(!this.closed){this.closed=!0;const{_parentage:x}=this;if(x)if(this._parentage=null,Array.isArray(x))for(const le of x)le.remove(this);else x.remove(this);const{initialTeardown:Ae}=this;if((0,E.m)(Ae))try{Ae()}catch(le){d=le instanceof M.B?le.errors:[le]}const{_finalizers:he}=this;if(he){this._finalizers=null;for(const le of he)try{Q(le)}catch(Ce){d=d??[],Ce instanceof M.B?d=[...d,...Ce.errors]:d.push(Ce)}}if(d)throw new M.B(d)}}add(d){var x;if(d&&d!==this)if(this.closed)Q(d);else{if(d instanceof m){if(d.closed||d._hasParent(this))return;d._addParent(this)}(this._finalizers=null!==(x=this._finalizers)&&void 0!==x?x:[]).push(d)}}_hasParent(d){const{_parentage:x}=this;return x===d||Array.isArray(x)&&x.includes(d)}_addParent(d){const{_parentage:x}=this;this._parentage=Array.isArray(x)?(x.push(d),x):x?[x,d]:d}_removeParent(d){const{_parentage:x}=this;x===d?this._parentage=null:Array.isArray(x)&&(0,z.P)(x,d)}remove(d){const{_finalizers:x}=this;x&&(0,z.P)(x,d),d instanceof m&&d._removeParent(this)}}function A(G){return G instanceof m||G&&"closed"in G&&(0,E.m)(G.remove)&&(0,E.m)(G.add)&&(0,E.m)(G.unsubscribe)}function Q(G){(0,E.m)(G)?G():G.unsubscribe()}m.EMPTY=(()=>{const G=new m;return G.closed=!0,G})()},9940:(l,b,s)=>{s.d(b,{yG:()=>m});var E=s(671);function m(A){return(0,E.K)(function M(A){return A[A.length-1]}(A))?A.pop():void 0}},9360:(l,b,s)=>{s.d(b,{e:()=>z});var E=s(4674);function z(m){return J=>{if(function M(m){return(0,E.m)(m?.lift)}(J))return J.lift(function(A){try{return m(A,this)}catch(Q){this.error(Q)}});throw new TypeError("Unable to lift unknown Observable type")}}},8407:(l,b,s)=>{s.d(b,{U:()=>z});var E=s(2737);function z(m){return 0===m.length?E.y:1===m.length?m[0]:function(A){return m.reduce((Q,G)=>G(Q),A)}}}},xe={};function h(l){var b=xe[l];if(void 0!==b)return b.exports;var s=xe[l]={exports:{}};return be[l](s,s.exports,h),s.exports}h.m=be,h.x=()=>{var l=h.O(void 0,[709],()=>h(8459));return h.O(l)},l=[],h.O=(b,s,E,M)=>{if(!s){var m=1/0;for(z=0;z<l.length;z++){for(var[s,E,M]=l[z],J=!0,A=0;A<s.length;A++)(!1&M||m>=M)&&Object.keys(h.O).every(he=>h.O[he](s[A]))?s.splice(A--,1):(J=!1,M<m&&(m=M));if(J){l.splice(z--,1);var Q=E();void 0!==Q&&(b=Q)}}return b}M=M||0;for(var z=l.length;z>0&&l[z-1][2]>M;z--)l[z]=l[z-1];l[z]=[s,E,M]},h.d=(l,b)=>{for(var s in b)h.o(b,s)&&!h.o(l,s)&&Object.defineProperty(l,s,{enumerable:!0,get:b[s]})},h.f={},h.e=l=>Promise.all(Object.keys(h.f).reduce((b,s)=>(h.f[s](l,b),b),[])),h.u=l=>l+".7976c1444f5fa77c.js",h.miniCssF=l=>{},h.o=(l,b)=>Object.prototype.hasOwnProperty.call(l,b),(()=>{var l;h.tt=()=>(void 0===l&&(l={createScriptURL:b=>b},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(l=trustedTypes.createPolicy("angular#bundler",l))),l)})(),h.tu=l=>h.tt().createScriptURL(l),h.p="",(()=>{var l={105:1};h.f.i=(M,z)=>{l[M]||importScripts(h.tu(h.p+h.u(M)))};var s=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],E=s.push.bind(s);s.push=M=>{var[z,m,J]=M;for(var A in m)h.o(m,A)&&(h.m[A]=m[A]);for(J&&J(h);z.length;)l[z.pop()]=1;E(M)}})(),(()=>{var l=h.x;h.x=()=>h.e(709).then(l)})(),h.x()})();