(()=>{var x={7156:l=>{function m(s,g,a,e,t,i,d){try{var r=s[i](d),o=r.value}catch(u){return void a(u)}r.done?g(o):Promise.resolve(o).then(e,t)}l.exports=function n(s){return function(){var g=this,a=arguments;return new Promise(function(e,t){var i=s.apply(g,a);function d(o){m(i,e,t,d,r,"next",o)}function r(o){m(i,e,t,d,r,"throw",o)}d(void 0)})}},l.exports.__esModule=!0,l.exports.default=l.exports},8416:(l,m,n)=>{var s=n(4062);l.exports=function g(a,e,t){return(e=s(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a},l.exports.__esModule=!0,l.exports.default=l.exports},5036:(l,m,n)=>{var s=n(8698).default;l.exports=function g(a,e){if("object"!==s(a)||null===a)return a;var t=a[Symbol.toPrimitive];if(void 0!==t){var i=t.call(a,e||"default");if("object"!==s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(a)},l.exports.__esModule=!0,l.exports.default=l.exports},4062:(l,m,n)=>{var s=n(8698).default,g=n(5036);l.exports=function a(e){var t=g(e,"string");return"symbol"===s(t)?t:String(t)},l.exports.__esModule=!0,l.exports.default=l.exports},8698:l=>{function m(n){return l.exports=m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},l.exports.__esModule=!0,l.exports.default=l.exports,m(n)}l.exports=m,l.exports.__esModule=!0,l.exports.default=l.exports}},b={};function c(l){var m=b[l];if(void 0!==m)return m.exports;var n=b[l]={exports:{}};return x[l](n,n.exports,c),n.exports}(()=>{"use strict";var l=c(7156).default,m=c(8416).default;const n=new Map;let s;addEventListener("message",a=>{switch(a.data.msg){case"hello":postMessage({msg:`worker response to ${a.data.msg}`});break;case"load":try{const e=self;e.Module={scriptUrl:"content/sqlite/sqlite3.js"},e.importScripts(e.Module.scriptUrl),e.sqlite3InitModule({print:console.log,printErr:console.error}).then(function(t){s=t,console.log("Done initializing. Running demo..."),postMessage({msg:"databaseReady",uid:"0"})})}finally{}break;case"addAligneImage":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),n.set(a.data.exam,e)),e.addAligneImage(s,a.data);break}case"addNonAligneImage":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.addNonAligneImage(s,a.data);break}case"resetDatabase":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.resetDatabase(s,a.data);break}case"removeExam":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.removeExam(s,a.data);break}case"removeElementForExam":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.removeElementForExam(s,a.data);break}case"removeElementForExamForPages":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.removeElementForExamForPages(s,a.data);break}case"export":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.export(s,a.data);break}case"import":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.import(s,a.data);break}case"countPageTemplate":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.countPageTemplate(s,a.data);break}case"countAlignImage":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.countAlignImage(s,a.data);break}case"countNonAlignImage":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.countNonAlignImage(s,a.data);break}case"getFirstNonAlignImage":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getFirstNonAlignImage(s,a.data);break}case"getFirstAlignImage":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getFirstAlignImage(s,a.data);break}case"getFirstTemplate":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getFirstTemplate(s,a.data);break}case"getNonAlignImageBetweenAndSortByPageNumber":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getNonAlignImageBetweenAndSortByPageNumber(s,a.data);break}case"getAlignImageBetweenAndSortByPageNumber":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getAlignImageBetweenAndSortByPageNumber(s,a.data);break}case"getNonAlignImagesForPageNumbers":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getNonAlignImagesForPageNumbers(s,a.data);break}case"getAlignImagesForPageNumbers":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getAlignImagesForPageNumbers(s,a.data);break}case"getNonAlignSortByPageNumber":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getNonAlignSortByPageNumber(s,a.data);break}case"getAlignSortByPageNumber":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.getAlignSortByPageNumber(s,a.data);break}case"addExam":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.addExam(s,a.data);break}case"addTemplate":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.addTemplate(s,a.data);break}case"countNonAlignWithPageNumber":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.countNonAlignWithPageNumber(s,a.data);break}case"countAlignWithPageNumber":{let e=n.get(a.data.payload.examId);void 0===e&&(e=new g(a.data.payload.examId),e.initemptyDb(s),n.set(a.data.exam,e)),e.countAlignWithPageNumber(s,a.data);break}}});class g{constructor(e){m(this,"examName",void 0),m(this,"db",void 0),m(this,"counter",0),this.examName=e}error(...e){console.error(...e)}initDb(e){const t=e.oo1;e.opfs?(this.db=new t.OpfsDb("/"+this.examName+".sqlite3"),console.log("The OPFS is available.")):(this.db=new t.DB("/"+this.examName+".sqlite3","ct"),console.log("The OPFS is not available."))}initemptyDb(e){this.initDb(e);try{this.db.exec("CREATE TABLE IF NOT EXISTS template(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("CREATE TABLE IF NOT EXISTS align(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("CREATE TABLE IF NOT EXISTS nonalign(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)")}finally{this.db.close()}}addAligneImage(e,t){const i=t.payload;this.initDb(e);try{this.db.selectValue("select count(*) from align where page="+i.pageNumber)>0&&this.db.exec({sql:"delete from align where page="+i.pageNumber}),this.db.exec({sql:"INSERT INTO align(page,imageData ) VALUES (?,?)",bind:[i.pageNumber,i.value]})}finally{this.db.close(),postMessage({msg:t.msg,uid:t.uid})}}addNonAligneImage(e,t){const i=t.payload;this.initDb(e);try{this.db.selectValue("select count(*) from nonalign where page="+i.pageNumber)>0&&this.db.exec({sql:"delete from nonalign where page="+i.pageNumber}),this.db.exec({sql:"INSERT INTO nonalign(page,imageData ) VALUES (?,?)",bind:[i.pageNumber,i.value]})}finally{this.db.close(),postMessage({msg:t.msg,uid:t.uid})}}addTemplate(e,t){const i=t.payload;this.initDb(e);try{this.db.selectValue("select count(*) from template where page="+i.elt.pageNumber)>0&&this.db.exec({sql:"delete from template where page="+i.elt.pageNumber}),this.db.exec({sql:"INSERT INTO template(page,imageData ) VALUES (?,?)",bind:[i.elt.pageNumber,i.elt.value]})}finally{this.db.close(),postMessage({msg:t.msg,uid:t.uid})}}resetDatabase(e,t){var i=this;return l(function*(){try{if(void 0!==navigator.storage.getDirectory){const d=yield navigator.storage.getDirectory(),r=d.keys();let o=yield r.next();for(;void 0!==o.value;)(o.value.endsWith(".sqlite3")||o.value.endsWith("sqlite3-journal"))&&(yield d.removeEntry(o.value)),o=yield r.next();i.initemptyDb(e)}}finally{postMessage({msg:t.msg,uid:t.uid})}})()}removeExam(e,t){var i=this;return l(function*(){try{if(void 0!==navigator.storage.getDirectory){const d=yield navigator.storage.getDirectory(),r=d.keys();let o=yield r.next();for(;void 0!==o.value;)o.value===i.examName+".sqlite3"?yield d.removeEntry(i.examName+".sqlite3"):o.value===i.examName+".sqlite3-journal"&&(yield d.removeEntry(i.examName+".sqlite3-journal")),o=yield r.next();i.initemptyDb(e)}}finally{postMessage({msg:t.msg,uid:t.uid})}})()}removeElementForExam(e,t){var i=this;return l(function*(){try{if(void 0!==navigator.storage.getDirectory){const d=yield navigator.storage.getDirectory(),r=d.keys();let o=yield r.next();for(;void 0!==o.value;)o.value===i.examName+".sqlite3"?yield d.removeEntry(i.examName+".sqlite3"):o.value===i.examName+".sqlite3-journal"&&(yield d.removeEntry(i.examName+".sqlite3-journal")),o=yield r.next();i.initemptyDb(e)}}finally{postMessage({msg:t.msg,uid:t.uid})}})()}removeElementForExamForPages(e,t){const i=t.payload;this.initDb(e);try{this.db.exec("delete from nonalign where page>="+i.pageStart+" and page <= "+i.pageEnd),this.db.exec("delete from align where page>="+i.pageStart+" and page <= "+i.pageEnd),postMessage({msg:t.msg,uid:t.uid,payload:{}})}finally{this.db.close()}}export(e,t){var i=this;return l(function*(){if(void 0!==navigator.storage.getDirectory){const d=yield navigator.storage.getDirectory(),r=d.keys();let o=yield r.next();for(;void 0!==o.value;){if(o.value===i.examName+".sqlite3"){const p=yield(yield d.getFileHandle(i.examName+".sqlite3")).getFile(),f=yield p.arrayBuffer(),y=new Blob([new Uint8Array(f)],{type:p.type});postMessage({msg:t.msg,uid:t.uid,payload:y});break}o=yield r.next()}}else postMessage({msg:t.msg,uid:t.uid})})()}import(e,t){var i=this;return l(function*(){const r=t.payload.blob;if(void 0!==navigator.storage.getDirectory){const o=yield navigator.storage.getDirectory(),u=o.keys();let p=yield u.next();for(;void 0!==p.value;)p.value===i.examName+".sqlite3"?yield o.removeEntry(i.examName+".sqlite3"):p.value===i.examName+".sqlite3-journal"&&(yield o.removeEntry(i.examName+".sqlite3-journal")),p=yield u.next();const y=yield(yield o.getFileHandle(i.examName+".sqlite3",{create:!0})).createWritable();try{yield y.write(r)}finally{yield y.close()}}i.initDb(e),i.db.close(),postMessage({msg:t.msg,uid:t.uid})})()}countPageTemplate(e,t){this.initDb(e);try{const i=this.db.selectValue("select count(*) from template");postMessage({msg:t.msg,uid:t.uid,payload:i})}finally{this.db.close()}}countAlignImage(e,t){this.initDb(e);try{const i=this.db.selectValue("select count(*) from align");postMessage({msg:t.msg,uid:t.uid,payload:i})}finally{this.db.close()}}countNonAlignImage(e,t){this.initDb(e);try{const i=this.db.selectValue("select count(*) from nonalign");postMessage({msg:t.msg,uid:t.uid,payload:i})}finally{this.db.close()}}getFirstNonAlignImage(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectValue("select imageData from nonalign where page="+i.pageInscan);postMessage({msg:t.msg,uid:t.uid,payload:{value:d,examId:i.examId,pageNumber:i.pageNumber}})}finally{this.db.close()}}getFirstAlignImage(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectValue("select imageData from align where page="+i.pageInscan);postMessage({msg:t.msg,uid:t.uid,payload:{value:d,examId:i.examId,pageNumber:i.pageNumber}})}finally{this.db.close()}}getFirstTemplate(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectValue("select imageData from template where page="+i.pageInscan);postMessage({msg:t.msg,uid:t.uid,payload:{value:d,examId:i.examId,pageNumber:i.pageNumber}})}finally{this.db.close()}}getNonAlignImagesForPageNumbers(e,t){const i=t.payload;if(void 0!==i.pages&&void 0!==i.pages.joins){this.initDb(e);try{const d=this.db.selectArrays("select page,imageData from nonalign where page in ("+i.pages.join(",")+") order by page asc"),r=[];d.forEach(o=>{r.push({pageNumber:o[0],examId:this.examName,value:o[1]})}),postMessage({msg:t.msg,uid:t.uid,payload:r})}finally{this.db.close()}}}getAlignImagesForPageNumbers(e,t){const i=t.payload;if(void 0!==i.pages&&void 0!==i.pages.joins){this.initDb(e);try{const d=this.db.selectArrays("select page,imageData from align where page in ("+i.pages.join(",")+") order by page asc"),r=[];d.forEach(o=>{r.push({pageNumber:o[0],examId:this.examName,value:o[1]})}),postMessage({msg:t.msg,uid:t.uid,payload:r})}finally{this.db.close()}}}getNonAlignImageBetweenAndSortByPageNumber(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectArrays("select page,imageData from nonalign where page>="+i.p1+" and page <= "+i.p2+" order by page asc"),r=[];d.forEach(o=>{r.push({pageNumber:o[0],examId:this.examName,value:o[1]})}),postMessage({msg:t.msg,uid:t.uid,payload:r})}finally{this.db.close()}}getAlignImageBetweenAndSortByPageNumber(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectArrays("select page,imageData from align where page>="+i.p1+" and page <= "+i.p2+" order by page asc"),r=[];d.forEach(o=>{r.push({pageNumber:o[0],examId:this.examName,value:o[1]})}),postMessage({msg:t.msg,uid:t.uid,payload:r})}finally{this.db.close()}}getNonAlignSortByPageNumber(e,t){this.initDb(e);try{const i=this.db.selectArrays("select page,imageData from nonalign order by page asc"),d=[];i.forEach(r=>{d.push({pageNumber:r[0],examId:this.examName,value:r[1]})}),postMessage({msg:t.msg,uid:t.uid,payload:d})}finally{this.db.close()}}getAlignSortByPageNumber(e,t){this.initDb(e);try{const i=this.db.selectArrays("select page,imageData from align order by page asc"),d=[];i.forEach(r=>{d.push({pageNumber:r[0],examId:this.examName,value:r[1]})}),postMessage({msg:t.msg,uid:t.uid,payload:d})}finally{this.db.close()}}addExam(e,t){try{this.initemptyDb(e)}finally{postMessage({msg:t.msg,uid:t.uid})}}countNonAlignWithPageNumber(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectValue("select count(*) from nonalign where page="+i.pageInscan);postMessage({msg:t.msg,uid:t.uid,payload:d})}finally{this.db.close()}}countAlignWithPageNumber(e,t){const i=t.payload;this.initDb(e);try{const d=this.db.selectValue("select count(*) from align where page="+i.pageInscan);postMessage({msg:t.msg,uid:t.uid,payload:d})}finally{this.db.close()}}}})()})();