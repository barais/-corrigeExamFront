(()=>{var d,I={3827:(d,u,p)=>{"use strict";var f=p(7156).default,c=p(8416).default;const s=new Map;let i;addEventListener("message",a=>{switch(a.data.msg){case"hello":postMessage({msg:`worker response to ${a.data.msg}`});break;case"load":try{const e=self;e.Module={scriptUrl:"content/sqlite/sqlite3.js"},e.importScripts(e.Module.scriptUrl),e.sqlite3InitModule({print:console.log,printErr:console.error}).then(function(n){i=n,postMessage({msg:"databaseReady",uid:"0"})})}finally{}break;case"addAligneImage":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),s.set(a.data.payload.examId,e)),e.addAligneImage(i,a.data);break}case"addNonAligneImage":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.addNonAligneImage(i,a.data);break}case"resetDatabase":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.resetDatabase(i,a.data);break}case"removeExam":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.removeExam(i,a.data);break}case"removeElementForExam":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.removeElementForExam(i,a.data);break}case"removePageAlignForExam":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.removePageAlignForExam(i,a.data);break}case"removeElementForExamForPages":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.removeElementForExamForPages(i,a.data);break}case"removePageAlignForExamForPages":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.removePageAlignForExamForPages(i,a.data);break}case"removePageNonAlignForExamForPages":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.removePageNonAlignForExamForPages(i,a.data);break}case"export":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.export(i,a.data);break}case"import":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.import(i,a.data);break}case"countPageTemplate":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.countPageTemplate(i,a.data);break}case"countAlignImage":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.countAlignImage(i,a.data);break}case"countNonAlignImage":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.countNonAlignImage(i,a.data);break}case"getFirstNonAlignImage":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getFirstNonAlignImage(i,a.data);break}case"getFirstAlignImage":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getFirstAlignImage(i,a.data);break}case"getFirstTemplate":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getFirstTemplate(i,a.data);break}case"getNonAlignImageBetweenAndSortByPageNumber":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getNonAlignImageBetweenAndSortByPageNumber(i,a.data);break}case"getAlignImageBetweenAndSortByPageNumber":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getAlignImageBetweenAndSortByPageNumber(i,a.data);break}case"getNonAlignImagesForPageNumbers":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getNonAlignImagesForPageNumbers(i,a.data);break}case"getAlignImagesForPageNumbers":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getAlignImagesForPageNumbers(i,a.data);break}case"getNonAlignSortByPageNumber":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getNonAlignSortByPageNumber(i,a.data);break}case"getAlignSortByPageNumber":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.getAlignSortByPageNumber(i,a.data);break}case"addExam":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.addExam(i,a.data);break}case"addTemplate":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.addTemplate(i,a.data);break}case"countNonAlignWithPageNumber":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.countNonAlignWithPageNumber(i,a.data);break}case"countAlignWithPageNumber":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.countAlignWithPageNumber(i,a.data);break}case"moveNonAlignPages":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.moveNonAlignPages(i,a.data);break}case"moveAlignPages":{let e=s.get(a.data.payload.examId);void 0===e&&(e=new l(a.data.payload.examId),e.initemptyDb(i),s.set(a.data.payload.examId,e)),e.moveAlignPages(i,a.data);break}}});class l{constructor(e){c(this,"examName",void 0),c(this,"db",void 0),this.examName=e}error(...e){console.error(...e)}initDb(e){if(void 0===this.db||!this.db.isOpen()){const n=e.oo1;this.db=e.opfs?new n.OpfsDb("/"+this.examName+".sqlite3"):new n.DB("/"+this.examName+".sqlite3","ct")}}close(){this.db.close()}closeOther(){}initemptyDb(e){this.initDb(e);try{this.db.exec("CREATE TABLE IF NOT EXISTS template(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("CREATE TABLE IF NOT EXISTS align(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)"),this.db.exec("CREATE TABLE IF NOT EXISTS nonalign(page INTEGER NOT NULL PRIMARY KEY,imageData CLOB NOT NULL)")}finally{this.close()}}addAligneImage(e,n){const t=n.payload;this.initDb(e);try{this.db.selectValue("select count(*) from align where page="+t.pageNumber)>0&&this.db.exec({sql:"delete from align where page="+t.pageNumber});const o=new TextDecoder("utf-8"),g=new Uint8Array(t.value);this.db.exec({sql:"INSERT INTO align(page,imageData ) VALUES (?,?)",bind:[t.pageNumber,o.decode(g)]})}finally{this.close(),postMessage({msg:n.msg,uid:n.uid})}}addNonAligneImage(e,n){const t=n.payload;this.initDb(e);try{this.db.selectValue("select count(*) from nonalign where page="+t.pageNumber)>0&&this.db.exec({sql:"delete from nonalign where page="+t.pageNumber});const o=new TextDecoder("utf-8"),g=new Uint8Array(t.value);this.db.exec({sql:"INSERT INTO nonalign(page,imageData ) VALUES (?,?)",bind:[t.pageNumber,o.decode(g)]})}finally{this.close(),postMessage({msg:n.msg,uid:n.uid})}}addTemplate(e,n){const t=n.payload;this.initDb(e);try{this.db.selectValue("select count(*) from template where page="+t.pageNumber)>0&&this.db.exec({sql:"delete from template where page="+t.pageNumber});const o=new TextDecoder("utf-8"),g=new Uint8Array(t.value);this.db.exec({sql:"INSERT INTO template(page,imageData ) VALUES (?,?)",bind:[t.pageNumber,o.decode(g)]})}finally{this.close(),postMessage({msg:n.msg,uid:n.uid})}}resetDatabase(e,n){var t=this;return f(function*(){try{if(void 0!==navigator.storage.getDirectory){const o=yield navigator.storage.getDirectory(),g=o.keys();let r=yield g.next();for(;void 0!==r.value;)(r.value.endsWith(".sqlite3")||r.value.endsWith("sqlite3-journal"))&&(yield o.removeEntry(r.value)),r=yield g.next();t.initemptyDb(e)}}finally{postMessage({msg:n.msg,uid:n.uid})}})()}removeExam(e,n){var t=this;return f(function*(){try{if(void 0!==navigator.storage.getDirectory){const o=yield navigator.storage.getDirectory(),g=o.keys();let r=yield g.next();for(;void 0!==r.value;)r.value===t.examName+".sqlite3"?yield o.removeEntry(t.examName+".sqlite3"):r.value===t.examName+".sqlite3-journal"&&(yield o.removeEntry(t.examName+".sqlite3-journal")),r=yield g.next();t.initemptyDb(e)}}finally{postMessage({msg:n.msg,uid:n.uid})}})()}removeElementForExam(e,n){var t=this;return f(function*(){try{if(void 0!==navigator.storage.getDirectory){const o=yield navigator.storage.getDirectory(),g=o.keys();let r=yield g.next();for(;void 0!==r.value;)r.value===t.examName+".sqlite3"?yield o.removeEntry(t.examName+".sqlite3"):r.value===t.examName+".sqlite3-journal"&&(yield o.removeEntry(t.examName+".sqlite3-journal")),r=yield g.next();t.initemptyDb(e)}}finally{postMessage({msg:n.msg,uid:n.uid})}})()}removePageAlignForExam(e,n){this.initDb(e);try{this.db.exec("delete from align"),postMessage({msg:n.msg,uid:n.uid,payload:{}})}finally{this.close()}}removeElementForExamForPages(e,n){const t=n.payload;this.initDb(e);try{this.db.exec("delete from nonalign where page>="+t.pageStart+" and page <= "+t.pageEnd),this.db.exec("delete from align where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:n.msg,uid:n.uid,payload:{}})}finally{this.close()}}removePageAlignForExamForPages(e,n){const t=n.payload;this.initDb(e);try{this.db.exec("delete from align where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:n.msg,uid:n.uid,payload:{}})}finally{this.close()}}removePageNonAlignForExamForPages(e,n){const t=n.payload;this.initDb(e);try{this.db.exec("delete from nonalign where page>="+t.pageStart+" and page <= "+t.pageEnd),postMessage({msg:n.msg,uid:n.uid,payload:{}})}finally{this.close()}}export(e,n){var t=this;return f(function*(){if(void 0!==navigator.storage.getDirectory){const o=yield navigator.storage.getDirectory(),g=o.keys();let r=yield g.next();for(;void 0!==r.value;){if(r.value===t.examName+".sqlite3"){const y=yield(yield o.getFileHandle(t.examName+".sqlite3")).getFile(),x=yield y.arrayBuffer(),h=new Blob([new Uint8Array(x)],{type:y.type});postMessage({msg:n.msg,uid:n.uid,payload:h});break}r=yield g.next()}}else postMessage({msg:n.msg,uid:n.uid})})()}import(e,n){var t=this;return f(function*(){const g=n.payload.blob;if(void 0!==navigator.storage.getDirectory){const r=yield navigator.storage.getDirectory(),b=r.keys();let y=yield b.next();for(;void 0!==y.value;)y.value===t.examName+".sqlite3"?yield r.removeEntry(t.examName+".sqlite3"):y.value===t.examName+".sqlite3-journal"&&(yield r.removeEntry(t.examName+".sqlite3-journal")),y=yield b.next();const h=yield(yield r.getFileHandle(t.examName+".sqlite3",{create:!0})).createWritable();try{yield h.write(g)}finally{yield h.close()}}t.initDb(e),t.close(),postMessage({msg:n.msg,uid:n.uid})})()}countPageTemplate(e,n){this.initDb(e);try{const t=this.db.selectValue("select count(*) from template");postMessage({msg:n.msg,uid:n.uid,payload:t})}finally{this.close()}}countAlignImage(e,n){this.initDb(e);try{const t=this.db.selectValue("select count(*) from align");postMessage({msg:n.msg,uid:n.uid,payload:t})}finally{this.close()}}countNonAlignImage(e,n){this.initDb(e);try{const t=this.db.selectValue("select count(*) from nonalign");postMessage({msg:n.msg,uid:n.uid,payload:t})}finally{this.close()}}getFirstNonAlignImage(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectValue("select imageData from nonalign where page="+t.pageInscan),r=(new TextEncoder).encode(o).buffer;postMessage({msg:n.msg,uid:n.uid,payload:{value:r,examId:t.examId,pageNumber:t.pageNumber}},[r])}finally{this.close()}}getFirstAlignImage(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectValue("select imageData from align where page="+t.pageInscan),r=(new TextEncoder).encode(o).buffer;postMessage({msg:n.msg,uid:n.uid,payload:{value:r,examId:t.examId,pageNumber:t.pageNumber}},[r])}finally{this.close()}}getFirstTemplate(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectValue("select imageData from template where page="+t.pageInscan),r=(new TextEncoder).encode(o).buffer;postMessage({msg:n.msg,uid:n.uid,payload:{value:r,examId:t.examId,pageNumber:t.pageNumber}},[r])}finally{this.close()}}getNonAlignImagesForPageNumbers(e,n){const t=n.payload;if(void 0!==t.pages&&void 0!==t.pages.joins){this.initDb(e);try{const o=this.db.selectArrays("select page,imageData from nonalign where page in ("+t.pages.join(",")+") order by page asc"),g=[],r=new TextEncoder,b=[];o.forEach(y=>{const x=r.encode(y[1]).buffer;b.push(x),g.push({pageNumber:y[0],examId:this.examName,value:x})}),postMessage({msg:n.msg,uid:n.uid,payload:g},b)}finally{this.close()}}}getAlignImagesForPageNumbers(e,n){const t=n.payload;if(void 0!==t.pages&&void 0!==t.pages.joins){this.initDb(e);try{const o=this.db.selectArrays("select page,imageData from align where page in ("+t.pages.join(",")+") order by page asc"),g=[],r=new TextEncoder,b=[];o.forEach(y=>{const x=r.encode(y[1]).buffer;b.push(x),g.push({pageNumber:y[0],examId:this.examName,value:x})}),postMessage({msg:n.msg,uid:n.uid,payload:g},b)}finally{this.close()}}}getNonAlignImageBetweenAndSortByPageNumber(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectArrays("select page,imageData from nonalign where page>="+t.p1+" and page <= "+t.p2+" order by page asc"),g=[],r=new TextEncoder,b=[];o.forEach(y=>{const x=r.encode(y[1]).buffer;b.push(x),g.push({pageNumber:y[0],examId:this.examName,value:x})}),postMessage({msg:n.msg,uid:n.uid,payload:g},b)}finally{this.close()}}getAlignImageBetweenAndSortByPageNumber(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectArrays("select page,imageData from align where page>="+t.p1+" and page <= "+t.p2+" order by page asc"),g=[],r=new TextEncoder,b=[];o.forEach(y=>{const x=r.encode(y[1]).buffer;b.push(x),g.push({pageNumber:y[0],examId:this.examName,value:x})}),postMessage({msg:n.msg,uid:n.uid,payload:g},b)}finally{this.close()}}getNonAlignSortByPageNumber(e,n){this.initDb(e);try{const t=this.db.selectArrays("select page,imageData from nonalign order by page asc"),o=[],g=new TextEncoder,r=[];t.forEach(b=>{const y=g.encode(b[1]).buffer;r.push(y),o.push({pageNumber:b[0],examId:this.examName,value:y})}),postMessage({msg:n.msg,uid:n.uid,payload:o},r)}finally{this.close()}}getAlignSortByPageNumber(e,n){this.initDb(e);try{const t=this.db.selectArrays("select page,imageData from align order by page asc"),o=[],g=new TextEncoder,r=[];t.forEach(b=>{const y=g.encode(b[1]).buffer;r.push(y),o.push({pageNumber:b[0],examId:this.examName,value:y})}),postMessage({msg:n.msg,uid:n.uid,payload:o},r)}finally{this.close()}}addExam(e,n){try{this.initemptyDb(e)}finally{postMessage({msg:n.msg,uid:n.uid})}}countNonAlignWithPageNumber(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectValue("select count(*) from nonalign where page="+t.pageInscan);postMessage({msg:n.msg,uid:n.uid,payload:o})}finally{this.close()}}countAlignWithPageNumber(e,n){const t=n.payload;this.initDb(e);try{const o=this.db.selectValue("select count(*) from align where page="+t.pageInscan);postMessage({msg:n.msg,uid:n.uid,payload:o})}finally{this.close()}}moveNonAlignPages(e,n){const t=n.payload;if(this.initDb(e),t.from!==t.to)try{const o=this.db.selectValue("update nonalign  set page=-1000 where page="+t.from);this.db.selectValue(t.from<t.to?"update nonalign  set page=page-1 where page>"+t.from+" and page<="+t.to:"update nonalign  set page=page+1 where page<"+t.from+" and page>="+t.to),this.db.selectValue("update nonalign set page="+t.to+" where page=-1000"),postMessage({msg:n.msg,uid:n.uid,payload:o})}finally{this.close()}}moveAlignPages(e,n){const t=n.payload;if(this.initDb(e),t.from!==t.to)try{const o=this.db.selectValue("update align  set page=-1000 where page="+t.from);this.db.selectValue(t.from<t.to?"update align  set page=page-1 where page>"+t.from+" and page<="+t.to:"update align  set page=page+1 where page<"+t.from+" and page>="+t.to),this.db.selectValue("update align set page="+t.to+" where page=-1000"),postMessage({msg:n.msg,uid:n.uid,payload:o})}finally{this.close()}}}},7156:d=>{function u(f,c,s,i,l,a,e){try{var n=f[a](e),t=n.value}catch(o){return void s(o)}n.done?c(t):Promise.resolve(t).then(i,l)}d.exports=function p(f){return function(){var c=this,s=arguments;return new Promise(function(i,l){var a=f.apply(c,s);function e(t){u(a,i,l,e,n,"next",t)}function n(t){u(a,i,l,e,n,"throw",t)}e(void 0)})}},d.exports.__esModule=!0,d.exports.default=d.exports},8416:(d,u,p)=>{var f=p(4062);d.exports=function c(s,i,l){return(i=f(i))in s?Object.defineProperty(s,i,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[i]=l,s},d.exports.__esModule=!0,d.exports.default=d.exports},5036:(d,u,p)=>{var f=p(8698).default;d.exports=function c(s,i){if("object"!==f(s)||null===s)return s;var l=s[Symbol.toPrimitive];if(void 0!==l){var a=l.call(s,i||"default");if("object"!==f(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(s)},d.exports.__esModule=!0,d.exports.default=d.exports},4062:(d,u,p)=>{var f=p(8698).default,c=p(5036);d.exports=function s(i){var l=c(i,"string");return"symbol"===f(l)?l:String(l)},d.exports.__esModule=!0,d.exports.default=d.exports}},v={};function m(d){var u=v[d];if(void 0!==u)return u.exports;var p=v[d]={exports:{}};return I[d](p,p.exports,m),p.exports}m.m=I,m.x=()=>{var d=m.O(void 0,[592],()=>m(3827));return m.O(d)},d=[],m.O=(u,p,f,c)=>{if(!p){var i=1/0;for(s=0;s<d.length;s++){for(var[p,f,c]=d[s],l=!0,a=0;a<p.length;a++)(!1&c||i>=c)&&Object.keys(m.O).every(r=>m.O[r](p[a]))?p.splice(a--,1):(l=!1,c<i&&(i=c));if(l){d.splice(s--,1);var e=f();void 0!==e&&(u=e)}}return u}c=c||0;for(var s=d.length;s>0&&d[s-1][2]>c;s--)d[s]=d[s-1];d[s]=[p,f,c]},m.d=(d,u)=>{for(var p in u)m.o(u,p)&&!m.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:u[p]})},m.f={},m.e=d=>Promise.all(Object.keys(m.f).reduce((u,p)=>(m.f[p](d,u),u),[])),m.u=d=>"common.6e82dc3b17db6d77.js",m.miniCssF=d=>{},m.o=(d,u)=>Object.prototype.hasOwnProperty.call(d,u),m.j=827,(()=>{var d;m.tt=()=>(void 0===d&&(d={createScriptURL:u=>u},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(d=trustedTypes.createPolicy("angular#bundler",d))),d)})(),m.tu=d=>m.tt().createScriptURL(d),m.p="",(()=>{var d={827:1};m.f.i=(c,s)=>{d[c]||importScripts(m.tu(m.p+m.u(c)))};var p=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],f=p.push.bind(p);p.push=c=>{var[s,i,l]=c;for(var a in i)m.o(i,a)&&(m.m[a]=i[a]);for(l&&l(m);s.length;)d[s.pop()]=1;f(c)}})(),(()=>{var d=m.x;m.x=()=>m.e(592).then(d)})(),m.x()})();