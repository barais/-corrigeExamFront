(()=>{"use strict";var n,_e={4681:(n,y,i)=>{var P=i(5e3),p=i(2076),A=i(4968),d=i(4004),K=i(9300),_=i(971),Y=i(4351),S=i(4469);var we=i(9751);!function ae(W){const e=new W,t=(0,A.R)(self,"message");return function ve(W,e){const t=e.pipe((0,d.U)(r=>r.data),(0,d.U)(r=>new P.P_(r.kind,r.value,r.error)),(0,K.h)(r=>"C"!==r.kind),(0,_.D)());return function w(W){return!!W.workUnit}(W)?t.pipe((0,Y.b)(r=>(0,p.D)(W.workUnit(r)).pipe((0,S.i)()))):W.work(t).pipe((0,S.i)())}(e,t).subscribe(r=>{const f=postMessage;(function s(W){return!!W.selectTransferables})(e)&&r.hasValue?f(r,e.selectTransferables(r.value)):f(r)})}(class Ce{constructor(){this.opencvready=new Promise(e=>{const t=self;t.Module={scriptUrl:"content/opencv/4/opencv.js",onRuntimeInitialized(){cv.then(r=>{cv=r,cv.ready.then(()=>{e()}).catch(f=>{console.log(f)})})}},t.importScripts(t.Module.scriptUrl)})}workUnit(e){return new we.y(t=>{this.opencvready.then(()=>{if(e.marker){const r=this.alignImageBasedOnCircle(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,e.pageNumber,e.preference);r.pageNumber=e.pageNumber,t.next(r),t.complete()}else try{const r=this.alignImage(e.imageA,e.imageB,e.widthA,e.heightA,e.widthB,e.heightB,!1,e.preference.numberofpointToMatch,e.preference.numberofpointToMatch,e.pageNumber);e.imageA=void 0,e.imageB=void 0,r.pageNumber=e.pageNumber,t.next(r),t.complete()}catch(r){console.error(r)}}).catch(r=>{console.log(r)})})}selectTransferables(e){return[e.imageAligned]}imageDataFromMat(e){const t=new cv.Mat,r=e.type()%8,f=r<=cv.CV_8S?1:r<=cv.CV_32S?1/256:255,h=r===cv.CV_8S||r===cv.CV_16S?128:0;switch(e.convertTo(t,cv.CV_8U,f,h),t.type()){case cv.CV_8UC1:cv.cvtColor(t,t,cv.COLOR_GRAY2RGBA);break;case cv.CV_8UC3:cv.cvtColor(t,t,cv.COLOR_RGB2RGBA);break;case cv.CV_8UC4:break;default:throw new Error("Bad number of channels (Source image must have 1, 3 or 4 channels)")}const G=new ImageData(new Uint8ClampedArray(t.data),t.cols,t.rows);return t.delete(),G}roi(e,t){const r=e.size().width,f=e.size().height;return t.x+t.width>r&&(t.width=r-t.x),t.y+t.height>f&&(t.height=f-t.y),t.x<0&&(t.x=0),t.y<0&&(t.y=0),e.roi(t)}alignImage(e,t,r,f,h,G,z,E,$,I){const M=new ImageData(new Uint8ClampedArray(e),r,f),k=new ImageData(new Uint8ClampedArray(t),h,G),c=cv.matFromImageData(M);let H=cv.matFromImageData(k),g=new cv.Mat,C=new cv.Mat;cv.cvtColor(H,g,cv.COLOR_BGRA2GRAY),cv.cvtColor(c,C,cv.COLOR_BGRA2GRAY);const O=Math.trunc(c.size().width/20);let N=[],v=[],T={},L=!1,b=!1,F=!1,x=!1;const R=Math.min(g.size().width,C.size().width),B=Math.min(g.size().height,C.size().height);if(z){let l=new cv.Rect(0,0,R,B);L=this.matchSmallImage(g,C,N,v,l,1,E,$,I),b=!0,F=!0,x=!0}else{let l=O;for(;!L&&l<3*R/4&&l<2*B/3;){let D=new cv.Rect(0,0,l,l);L=this.matchSmallImage(g,C,N,v,D,1,E,$,I),L||(l+=Math.trunc(R/10))}for(l=O;!b&&l<3*R/4&&l<2*B/3;){let D=new cv.Rect(R-l,0,R,l);b=this.matchSmallImage(g,C,N,v,D,2,E,$,I),b||(l+=Math.trunc(R/10))}for(l=O;!F&&l<3*R/4&&l<2*B/3;){let D=new cv.Rect(0,B-l,l,B);F=this.matchSmallImage(g,C,N,v,D,3,E,$,I),F||(l+=Math.trunc(R/10))}for(l=O;!x&&l<3*R/4&&l<2*B/3;){let D=new cv.Rect(R-l,B-l,R,B);x=this.matchSmallImage(g,C,N,v,D,4,E,$,I),x||(l+=Math.trunc(R/10))}}if(L&&b&&F&&x){let l=cv.matFromArray(4,1,cv.CV_32FC2,N),D=cv.matFromArray(4,1,cv.CV_32FC2,v),j=cv.getPerspectiveTransform(l,D),a=new cv.Mat;cv.warpPerspective(H,a,j,c.size(),cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),T.imageAligned=this.imageDataFromMat(a).data.buffer,T.imageAlignedWidth=a.size().width,T.imageAlignedHeight=a.size().height,l.delete(),D.delete(),j.delete(),a.delete(),console.log("Good match for page "+I)}else T.imageAligned=t.slice(0),T.imageAlignedWidth=h,T.imageAlignedHeight=G,console.log("no match for page "+I);return H.delete(),c.delete(),g.delete(),C.delete(),T}matchSmallImage(e,t,r,f,h,G,z,E,$){let I=new cv.Mat;I=this.roi(e,h);let M=new cv.Mat;M=this.roi(t,h);let k=new cv.KeyPointVector,c=new cv.KeyPointVector,H=new cv.Mat,g=new cv.Mat,C=new cv.AKAZE,O=new cv.Mat,N=new cv.Mat;C.detectAndCompute(I,O,k,H),C.detectAndCompute(M,N,c,g);let v=new cv.DMatchVector,T=new cv.BFMatcher,L=new cv.DMatchVectorVector;T.knnMatch(H,g,L,2);for(let a=0;a<L.size();++a){let V=L.get(a),Z=V.get(0),Q=V.get(1),ee="0.7";void 0!==Z&&void 0!==Q&&Z.distance<=Q.distance*parseFloat(ee)&&v.push_back(Z)}let b=[],F=[];for(let a=0;a<v.size();a++)b.push(k.get(v.get(a).queryIdx).pt.x+h.x),b.push(k.get(v.get(a).queryIdx).pt.y+h.y),F.push(c.get(v.get(a).trainIdx).pt.x+h.x),F.push(c.get(v.get(a).trainIdx).pt.y+h.y);let x=0,R=[];if(0===v.size())return C.delete(),k.delete(),c.delete(),H.delete(),g.delete(),O.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),T.delete(),!1;for(let a=0;a<v.size();a++){let V=(b[2*a]-F[2*a])*(b[2*a]-F[2*a])+(b[2*a+1]-F[2*a+1])*(b[2*a+1]-F[2*a+1]);V<Math.trunc(3*I.size().width/20)*Math.trunc(3*I.size().width/20)&&(R.push(V),x+=1)}const B=this.numAverage(R),l=this.dev(R);if(x<=z)return C.delete(),k.delete(),c.delete(),H.delete(),g.delete(),O.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),T.delete(),!1;let D=0,j=[];for(let a=0;a<v.size();a++){let V=(b[2*a]-F[2*a])*(b[2*a]-F[2*a])+(b[2*a+1]-F[2*a+1])*(b[2*a+1]-F[2*a+1]);if(V<B+1*l&&V>B-1*l){D+=1,j.push(a);break}}return D<=E?(C.delete(),k.delete(),c.delete(),H.delete(),g.delete(),O.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),T.delete(),!1):(j.forEach(a=>{r.push(k.get(v.get(+a).queryIdx).pt.x+h.x),r.push(k.get(v.get(+a).queryIdx).pt.y+h.y),f.push(c.get(v.get(+a).trainIdx).pt.x+h.x),f.push(c.get(v.get(+a).trainIdx).pt.y+h.y)}),C.delete(),k.delete(),c.delete(),H.delete(),g.delete(),O.delete(),N.delete(),I.delete(),M.delete(),L.delete(),v.delete(),T.delete(),!0)}numAverage(e){return e.reduce((t,r)=>t+r,0)/e.length}dev(e){let t=e.reduce((f,h)=>f+h,0)/e.length,r=(e=e.map(f=>(f-t)**2)).reduce((f,h)=>f+h,0);return Math.sqrt(r/e.length)}alignImageBasedOnCircle(e,t,r,f,h,G,z,E){const $=new ImageData(new Uint8ClampedArray(e),r,f),I=new ImageData(new Uint8ClampedArray(t),h,G);let C,O,N,v,T,L,b,F,x,R,B,l,M=cv.matFromImageData($),k=new cv.Mat,c=new cv.Mat;cv.cvtColor(M,M,cv.COLOR_RGBA2GRAY),cv.HoughCircles(M,c,cv.HOUGH_GRADIENT,1,45,75,20,M.cols*E.minCircle/1e3,M.cols*E.maxCircle/1e3),c.cols>0&&(C=c.data32F[0],O=c.data32F[1],N=c.data32F[2],v=c.data32F[0],T=c.data32F[1],L=c.data32F[2],b=c.data32F[0],F=c.data32F[1],x=c.data32F[2],R=c.data32F[0],B=c.data32F[1],l=c.data32F[2]);const D=M.size().width,j=M.size().height;if(c.cols>0)for(let U=1;U<c.cols;U++){let u=c.data32F[3*U],m=c.data32F[3*U+1],X=c.data32F[3*U+2];u*u+m*m<=C*C+O*O&&(C=u,O=m,N=X),u*u+m*m>=R*R+B*B&&(R=u,B=m,l=X),(D-u)*(D-u)+m*m<=(D-v)*(D-v)+T*T&&(v=u,T=m,L=X),u*u+(j-m)*(j-m)<=b*b+(j-F)*(j-F)&&(b=u,F=m,x=X)}let a=cv.matFromImageData(I),V=new cv.Mat,Z=new cv.Mat;cv.cvtColor(a,V,cv.COLOR_RGBA2GRAY);const Q=V.size().width,ee=V.size().height;cv.HoughCircles(V,Z,cv.HOUGH_GRADIENT,1,45,75,15,x-3,x+3);let J=[],le=[];const Ae=180*(4*x*x-3.14159*x*x)/100;for(let U=0;U<Z.cols;U++){let u=Z.data32F[3*U],m=Z.data32F[3*U+1];const X=u-x,ie=m-x;let te=2*x,re=2*x;X+te>Q&&(te=Q-X),ie+re>ee&&(re=ee-ie);let pe=new cv.Rect(u-x,m-x,te,re),ne=new cv.Mat;ne=this.roi(V,pe),cv.threshold(ne,ne,0,255,cv.THRESH_OTSU+cv.THRESH_BINARY),cv.countNonZero(ne)<Ae&&(J.push(u),le.push(m)),ne.delete()}let ce,oe,de,he,ue,fe,me,ge;if(J.length>0&&(ce=J[0],oe=le[0],de=J[0],he=le[0],ue=J[0],fe=le[0],me=J[0],ge=le[0]),J.length>1)for(let U=0;U<J.length;U++){let u=J[U],m=le[U];u*u+m*m<=ce*ce+oe*oe&&(ce=u,oe=m),u*u+m*m>=me*me+ge*ge&&(me=u,ge=m),(Q-u)*(Q-u)+m*m<=(Q-de)*(Q-de)+he*he&&(de=u,he=m),u*u+(ee-m)*(ee-m)<=ue*ue+(ee-fe)*(ee-fe)&&(ue=u,fe=m)}if(J.length>=4){let U=cv.matFromArray(4,1,cv.CV_32FC2,[C,O,v,T,b,F,R,B]),u=cv.matFromArray(4,1,cv.CV_32FC2,[ce,oe,de,he,ue,fe,me,ge]),m=cv.getPerspectiveTransform(u,U),X=new cv.Size(M.cols,M.rows);for(let re=0;re<U.rows;++re){let Me=15,xe=new cv.Point(u.data32F[2*re],u.data32F[2*re+1]);cv.circle(a,xe,Me,[0,0,255,255],1)}cv.warpPerspective(a,k,m,X,cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar);let ie=k.clone(),te={};return te.imageAligned=this.imageDataFromMat(ie).data.buffer,te.imageAlignedWidth=ie.size().width,te.imageAlignedHeight=ie.size().height,M.delete(),k.delete(),c.delete(),V.delete(),a.delete(),Z.delete(),U.delete(),u.delete(),ie.delete(),te}return M.delete(),k.delete(),c.delete(),V.delete(),a.delete(),Z.delete(),this.alignImage(e,t,r,f,h,G,!1,E.numberofpointToMatch,E.numberofgoodpointToMatch,z)}})},6921:(n,y,i)=>{i.d(y,{w0:()=>d,Nn:()=>_});var P=i(576),p=i(7896),A=i(8737);class d{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;const{_parentage:w}=this;if(w)if(this._parentage=null,Array.isArray(w))for(const q of w)q.remove(this);else w.remove(this);const{initialTeardown:ve}=this;if((0,P.m)(ve))try{ve()}catch(q){s=q instanceof p.B?q.errors:[q]}const{_finalizers:ae}=this;if(ae){this._finalizers=null;for(const q of ae)try{Y(q)}catch(se){s=s??[],se instanceof p.B?s=[...s,...se.errors]:s.push(se)}}if(s)throw new p.B(s)}}add(s){var w;if(s&&s!==this)if(this.closed)Y(s);else{if(s instanceof d){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=null!==(w=this._finalizers)&&void 0!==w?w:[]).push(s)}}_hasParent(s){const{_parentage:w}=this;return w===s||Array.isArray(w)&&w.includes(s)}_addParent(s){const{_parentage:w}=this;this._parentage=Array.isArray(w)?(w.push(s),w):w?[w,s]:s}_removeParent(s){const{_parentage:w}=this;w===s?this._parentage=null:Array.isArray(w)&&(0,A.P)(w,s)}remove(s){const{_finalizers:w}=this;w&&(0,A.P)(w,s),s instanceof d&&s._removeParent(this)}}function _(S){return S instanceof d||S&&"closed"in S&&(0,P.m)(S.remove)&&(0,P.m)(S.add)&&(0,P.m)(S.unsubscribe)}function Y(S){(0,P.m)(S)?S():S.unsubscribe()}d.EMPTY=(()=>{const S=new d;return S.closed=!0,S})()},3269:(n,y,i)=>{i.d(y,{yG:()=>d});var P=i(3532);function d(_){return(0,P.K)(function p(_){return _[_.length-1]}(_))?_.pop():void 0}},4482:(n,y,i)=>{i.d(y,{e:()=>A});var P=i(576);function A(d){return K=>{if(function p(d){return(0,P.m)(d?.lift)}(K))return K.lift(function(_){try{return d(_,this)}catch(Y){this.error(Y)}});throw new TypeError("Unable to lift unknown Observable type")}}},9635:(n,y,i)=>{i.d(y,{U:()=>A});var P=i(4671);function A(d){return 0===d.length?P.y:1===d.length?d[0]:function(_){return d.reduce((Y,S)=>S(Y),_)}}}},ye={};function o(n){var y=ye[n];if(void 0!==y)return y.exports;var i=ye[n]={exports:{}};return _e[n](i,i.exports,o),i.exports}o.m=_e,o.x=()=>{var n=o.O(void 0,[846],()=>o(4681));return o.O(n)},n=[],o.O=(y,i,P,p)=>{if(!i){var d=1/0;for(A=0;A<n.length;A++){for(var[i,P,p]=n[A],K=!0,_=0;_<i.length;_++)(!1&p||d>=p)&&Object.keys(o.O).every(ae=>o.O[ae](i[_]))?i.splice(_--,1):(K=!1,p<d&&(d=p));if(K){n.splice(A--,1);var Y=P();void 0!==Y&&(y=Y)}}return y}p=p||0;for(var A=n.length;A>0&&n[A-1][2]>p;A--)n[A]=n[A-1];n[A]=[i,P,p]},o.d=(n,y)=>{for(var i in y)o.o(y,i)&&!o.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:y[i]})},o.f={},o.e=n=>Promise.all(Object.keys(o.f).reduce((y,i)=>(o.f[i](n,y),y),[])),o.u=n=>n+".aae4597c878e9e76.js",o.miniCssF=n=>{},o.o=(n,y)=>Object.prototype.hasOwnProperty.call(n,y),(()=>{var n;o.tt=()=>(void 0===n&&(n={createScriptURL:y=>y},typeof trustedTypes<"u"&&trustedTypes.createPolicy&&(n=trustedTypes.createPolicy("angular#bundler",n))),n)})(),o.tu=n=>o.tt().createScriptURL(n),o.p="",(()=>{var n={507:1};o.f.i=(p,A)=>{n[p]||importScripts(o.tu(o.p+o.u(p)))};var i=self.webpackChunkgrade_scope_istic=self.webpackChunkgrade_scope_istic||[],P=i.push.bind(i);i.push=p=>{var[A,d,K]=p;for(var _ in d)o.o(d,_)&&(o.m[_]=d[_]);for(K&&K(o);A.length;)n[A.pop()]=1;P(p)}})(),(()=>{var n=o.x;o.x=()=>o.e(846).then(n)})(),o.x()})();